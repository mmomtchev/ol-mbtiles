"use strict";(self.webpackChunkol_mbtiles=self.webpackChunkol_mbtiles||[]).push([[757],{7757:(e,o,t)=>{t.r(o),t.d(o,{default:()=>p});var n=t(8859),r=t(8266),i=t(2479),l=t(9090),s=t(4717),a=t(6263),c=t(8661),d=t(1850),u=t(5917),h=function(e,o,t,n){return new(t||(t=Promise))((function(r,i){function l(e){try{a(n.next(e))}catch(e){i(e)}}function s(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var o;e.done?r(e.value):(o=e.value,o instanceof t?o:new t((function(e){e(o)}))).then(l,s)}a((n=n.apply(e,o||[])).next())}))};function p(){return h(this,void 0,void 0,(function*(){return new n.Z({target:"map",layers:[new i.Z({source:new r.Z}),new i.Z({source:new a.Z}),new s.Z({source:new d.H5(yield(0,d.ri)({url:"https://velivole.b-cdn.net/mbtiles/countries.mbtiles"})),style:u.kY})],view:new l.ZP({center:(0,c.mi)([12,50]),zoom:6})})}))}},5917:(e,o,t)=>{t.d(o,{Hh:()=>g,Xu:()=>h,d_:()=>p,kY:()=>c,oj:()=>w,xl:()=>m,y8:()=>a});var n=t(7539),r=t(283),i=t(1345),l=t(8958),s=t(1280);function a(e,o){let t,a;switch(e){case 0:t=6,a="2em";break;case 1:t=5,a="1.2em";break;case 2:t=3,a="0.8em";break;default:t=1,a="0.5em"}a+=" helvetica, sans-serif";const c="#00007f";return new n.ZP({image:new r.Z({fill:new i.Z({color:c}),radius:t,stroke:new l.Z({color:c,width:t})}),text:new s.Z({font:a,text:o.get("n"),fill:new i.Z({color:"#ffffff"}),stroke:new l.Z({color:c,width:2})})})}const c=new n.ZP({stroke:new l.Z({color:"blue",width:2})}),d={},u={motorway:"#776",trunk:"#ccb",highway:"#f39"},h=new n.ZP({fill:new i.Z({color:"#666"}),stroke:new l.Z({color:"#444",width:1})}),p=new n.ZP({fill:new i.Z({color:"#9db9e8"})}),w=new n.ZP({stroke:new l.Z({color:"#8B008B",width:2})}),m=function(e){const o=e.get("class"),t=e.get("railway"),r=e.get("sort_key"),i=o+"/"+t+"/"+r;let s=d[i];if(!s){let e,a;t?(e="#7de",a=1):(e=u[o],a="highway"==o?1.5:1),s=new n.ZP({stroke:new l.Z({color:e,width:a}),zIndex:r}),d[i]=s}return s},f=new n.ZP({image:new r.Z({radius:5,fill:new i.Z({color:"#000080"})})}),v=new l.Z({color:"white",width:2}),g=function(e){if("country"==e.get("class"))return null;if(e.get("name")){const o=f.clone();return o.setText(new s.Z({text:e.get("name"),offsetY:-5,font:"bold 16px sans-serif",stroke:v})),o}return null}},1850:(e,o,t)=>{t.d(o,{H5:()=>E,Yr:()=>k,ri:()=>x});var n,r=t(7273),i=t(8661),l=t(8641),s=t(8738),a=t(7205),c=t(3614),d=t(8929),u=t(7885),h=t(8087),p=t(9619),w=t(7571),m=t(4187),f=t(928),v=t(7195);const g="undefined"!=typeof process&&void 0!==(null===(n=null===process||void 0===process?void 0:process.env)||void 0===n?void 0:n.OL_MBTILES_DEBUG)&&process.env.OL_MBTILES_DEBUG?console.debug.bind(console):()=>{},Z={jpg:"raster",png:"raster",webp:"raster",pbf:"vector",mvt:"vector"};function y(e){var o,t,n;return{workers:null!==(o=null==e?void 0:e.sqlWorkers)&&void 0!==o?o:4,httpOptions:{backendType:null==e?void 0:e.backendType,maxPageSize:null!==(t=null==e?void 0:e.maxSqlPageSize)&&void 0!==t?t:4096,cacheSize:null!==(n=null==e?void 0:e.sqlCacheSize)&&void 0!==n?n:4096}}}function x(e){const o=(0,r.he)(y(e));return o.then((o=>o.open(e.url).then((()=>o)))).then((e=>e.exec("SELECT name,value FROM metadata"))).then((e=>{if(e&&e.length){const o=e.reduce(((e,o)=>(e[o.row[0]]=o.row[1],e)),{});return g("Loaded metadata",o),o}throw new Error("Could not load metadata")})).then((t=>{var n,r,a,c,d,u,h,p;const w=Object.assign({},e),m=null===(r=null===(n=t.format)||void 0===n?void 0:n.toLowerCase)||void 0===r?void 0:r.call(n);Z[m]||console.warn("Unknown tile format",m),w.projection=null!==(a=e.projection)&&void 0!==a?a:"EPSG:3857",w.attributions=null!==(c=t.attribution)&&void 0!==c?c:t.description,w.maxZoom=null!==(d=e.maxZoom)&&void 0!==d?d:+t.maxzoom,w.minZoom=null!==(u=e.minZoom)&&void 0!==u?u:+t.minzoom;const f=null===(p=null===(h=(0,i.U2)(w.projection))||void 0===h?void 0:h.getExtent)||void 0===p?void 0:p.call(h),v=t.bounds,g=v?(0,i.$A)(v.split(",").map((e=>+e)),"EPSG:4326",w.projection):f;if("raster"===Z[m]){if(void 0===w.maxZoom||void 0===w.minZoom||void 0===f)throw new Error("Cannot determine tilegrid, need minZoom, maxZoom");const e=[(0,l.dz)(f)/256];for(let o=1;o<=w.maxZoom;o++)e.push(e[e.length-1]/2);w.tileGrid=new s.Z({origin:[f[0],f[2]],extent:g,minZoom:w.minZoom,resolutions:e})}else w.extent=f;return w.pool=o,w.url=e.url,w})).catch((e=>o.then((e=>e.close())).then((()=>Promise.reject(e)))))}const b=m.q4.split(".").map((e=>+e)),P=b[0]>8||8===b[0]&&b[1]>=2;class C extends h.ZP{constructor(e){var o,t,n;super(),e=e||{},this.dataProjection=new p.Z({code:"",units:"tile-pixels"}),this.featureClass_=e.featureClass?e.featureClass:w.ZP,this.geometryName_=null!==(o=e.geometryName)&&void 0!==o?o:"Geometry",this.layers_=null!==(t=e.layers)&&void 0!==t?t:null,this.idProperty_=e.idProperty,this.extent=null!==(n=e.extent)&&void 0!==n?n:4096,this.supportedMediaTypes=["application/vnd-mbtiles"]}readFeature(e,o){const t=e.properties;let n;this.idProperty_?(n=t[this.idProperty_],delete t[this.idProperty_]):n=e.id;const r=e.loadGeometry(),i=[],l=[],s=C.MBTypes[r.length>1?"multi":"mono"][e.type];if("Unknown"===s)return null;for(let e=0;e<r.length;e++)if(0!=r[e].length){for(let o=0;o<r[e].length;o++)i.push(r[e][o].x,r[e][o].y);l.push(i.length)}const a=function(e,o,t,n,r,i){return P?new e(o,t,n,2,r,i):new e(o,t,n,r,i)}(this.featureClass_,s,i,l,t,n);return a.transform(null==o?void 0:o.dataProjection),a}readFeatures(e,o){const t=this.layers_,n=[],r=new d.VectorTile(new c(u.ZP.ungzip(e)));o=this.adaptOptions(o);const l=(0,i.U2)(null==o?void 0:o.dataProjection),s=null==o?void 0:o.extent;if(!l||!o||!s)throw new Error("Cannot determine the projection/extent");l.setWorldExtent(s),l.setExtent([0,0,this.extent,this.extent]),o.dataProjection=l;for(const e of Object.keys(r.layers)){if(t&&!t.includes(e))continue;const i=r.layers[e];for(let t=0;t<i.length;t++){const r=i.feature(t),l=this.readFeature(r,o);l.getProperties().layer=e,n.push(l)}}return n}readProjection(){return this.dataProjection}}C.MBTypes={mono:["Unknown","Point","LineString","Polygon"],multi:["Unknown","MultiPoint","MultiLineString","Polygon"]};class E extends a.Z{constructor(e){var o;if(void 0===e.url&&void 0===e.pool)throw new Error("Must specify url");super(Object.assign(Object.assign({},e),{url:void 0,format:new C({layers:e.layers}),tileUrlFunction:o=>`${e.url}#${o[0]}:${o[1]}:${o[2]}`})),this.setTileLoadFunction(this.tileLoader.bind(this)),this.pool=null!==(o=e.pool)&&void 0!==o?o:(0,r.he)(y(e)).then((o=>o.open(e.url).then((()=>o))))}tileLoader(e,o){const t=e;g("loading tile",[t.tileCoord[0],t.tileCoord[1],t.tileCoord[2]]),t.setLoader(((e,o,n)=>{this.pool.then((e=>e.exec("SELECT tile_data FROM tiles WHERE zoom_level = $zoom AND tile_column = $col AND tile_row = $row",{$zoom:t.tileCoord[0],$col:t.tileCoord[1],$row:(1<<t.tileCoord[0])-1-t.tileCoord[2]}))).then((o=>{if(o&&o[0]&&o[0].row[0]){const r=t.getFormat().readFeatures(o[0].row[0],{extent:e,featureProjection:n});return t.setFeatures(r),void t.onLoad(r,n)}throw new Error(`No data for ${t.tileCoord}`)})).catch((e=>{g(e),t.onError()}))}))}disposeInternal(){return this.pool.then((e=>e.close()))}}class k extends f.Z{constructor(e){var o;if(void 0===e.url&&void 0===e.pool)throw new Error("Must specify url");super(Object.assign(Object.assign({},e),{url:void 0,tileUrlFunction:o=>`${e.url}#${o[0]}:${o[1]}:${o[2]}`})),this.setTileLoadFunction(this.tileLoader.bind(this)),this.pool=null!==(o=e.pool)&&void 0!==o?o:(0,r.he)(y(e)).then((o=>o.open(e.url).then((()=>o))))}tileLoader(e,o){g("loading tile",[e.tileCoord[0],e.tileCoord[1],e.tileCoord[2]]);const t=e.getImage();this.pool.then((o=>o.exec("SELECT tile_data FROM tiles WHERE zoom_level = $zoom AND tile_column = $col AND tile_row = $row",{$zoom:e.tileCoord[0],$col:e.tileCoord[1],$row:(1<<e.tileCoord[0])-1-e.tileCoord[2]}))).then((o=>{if(!(o&&o[0]&&o[0].row[0]instanceof Uint8Array))throw new Error(`No data for ${e.tileCoord}`);{const e=new Blob([o[0].row[0]]),n=URL.createObjectURL(e);t.src=n}})).catch((o=>{g(o),e.setState(v.Z.ERROR)}))}disposeInternal(){return this.pool.then((e=>e.close()))}}},8266:(e,o,t)=>{t.d(o,{Z:()=>i});var n=t(4680);class r extends n.Z{constructor(e){let o;o=void 0!==(e=e||{}).attributions?e.attributions:['&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.'];const t=void 0!==e.crossOrigin?e.crossOrigin:"anonymous",n=void 0!==e.url?e.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:o,attributionsCollapsible:!1,cacheSize:e.cacheSize,crossOrigin:t,interpolate:e.interpolate,maxZoom:void 0!==e.maxZoom?e.maxZoom:19,opaque:void 0===e.opaque||e.opaque,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:n,wrapX:e.wrapX,zDirection:e.zDirection})}}const i=r}}]);
//# sourceMappingURL=757.bundle.js.map