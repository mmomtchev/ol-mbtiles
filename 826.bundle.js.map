{"version":3,"file":"826.bundle.js","mappings":"qOAYA,MAAMA,EAAuC,QAA1B,WAAc,oBAAY,eAAEC,YACzCC,GAAiB,QAASF,GAAc,IAC9C,SAASG,EAAYC,GACnB,MAAMC,EAAI,CAAEH,GACZ,IAAK,IAAII,EAAI,EAAGA,GAAKF,EAASE,IAC5BD,EAAEE,KAAKF,EAAEA,EAAEG,OAAS,GAAK,GAC3B,OAAOH,CACT,CAOe,SAAS,IACtB,OAAO,IAAI,IAAI,CACbI,OAAQ,MACRC,OAAQ,CACN,IAAI,IAAU,CACZC,OAAQ,GACRC,OAAQ,IAAI,MAEd,IAAI,IAAU,CACZD,OAAQ,EACRC,OAAQ,IAAI,MAEd,IAAI,IAAe,CACjBD,OAAQ,GACRE,QAAS,GACTD,OAAQ,IAAI,KAAoB,CAC9BE,IAAK,uDACLC,aAAc,CACZ,kBACA,cACA,iFAEFC,SAAU,IAAI,IAAS,CACrBC,OAAQ,CAACjB,EAAW,GAAIA,EAAW,IAEnCkB,OAAQ,CACN,mBACC,mBACD,mBACC,mBAEHC,QAAS,EACThB,YAAaA,EAAY,WAKjCiB,KAAM,IAAI,KAAK,CACbC,QAAQ,QAAW,CAAC,UAAW,WAC/BC,KAAM,KAGZ,C,mGCnEA,MAGaC,EAFS,oBAAZC,cAAqE,KAAvB,QAAZ,EAAO,OAAPA,cAAO,IAAPA,aAAO,EAAPA,QAASC,WAAG,eAAEC,mBAAoCF,QAAQC,IAAIC,iBAEtEC,QAAQJ,MAAMK,KAAKD,SAAW,KAAe,ECgG3EE,EAA+C,CACnD,IAAO,SACP,IAAO,SACP,KAAQ,SACR,IAAO,SACP,IAAO,UAGF,SAASC,EAAgBC,G,UAC9B,MAAO,CACLC,QAA4B,QAAnB,EAAAD,aAAO,EAAPA,EAASE,kBAAU,QAAI,EAChCC,YAAa,CACXC,YAAaJ,aAAO,EAAPA,EAASI,YACtBC,YAAoC,QAAvB,EAAAL,aAAO,EAAPA,EAASM,sBAAc,QAAI,KACxCC,UAAgC,QAArB,EAAAP,aAAO,EAAPA,EAASQ,oBAAY,QAAI,MAG1C,CAUO,SAASC,EAAwCC,GACtD,MAAMC,GAAgC,QAAqBZ,EAAgBW,IACxEE,MAAMD,GAASA,EAAKE,KAAKH,EAAI3B,KAAK6B,MAAK,IAAMD,MAEhD,OAAOA,EACJC,MAAME,GAAMA,EAAEC,KAAK,qCACnBH,MAAMtC,IACL,GAAIA,GAAKA,EAAEG,OAAQ,CAEjB,MAAMuC,EAAO1C,EAAE2C,QAAO,CAACC,EAAGC,KACxBD,EAAEC,EAAEC,IAAI,IAAgBD,EAAEC,IAAI,GACvBF,IACN,CAAC,GAEJ,OADA1B,EAAM,kBAAmBwB,GAClBA,C,CAET,MAAM,IAAIK,MAAM,0BAA0B,IAE3CT,MAAMU,I,oBACL,MAAMC,EAAO,iBAAIb,GAEXc,EAA8C,QAApC,EAAuB,QAAxB,EAACF,EAAW,cAAY,eAAEG,mBAAW,uBAC/C3B,EAAQ0B,IACX5B,QAAQ8B,KAAK,sBAAuBF,GAItCD,EAAKI,WAA2B,QAAd,EAAAjB,EAAIiB,kBAAU,QAAI,YACpCJ,EAAKvC,aAA8B,QAAd,EAAAsC,EAAGM,mBAAW,QAAIN,EAAGO,YAC1CN,EAAKlD,QAAqB,QAAX,EAAAqC,EAAIrC,eAAO,SAAKiD,EAAY,QAC3CC,EAAKnC,QAAqB,QAAX,EAAAsB,EAAItB,eAAO,SAAKkC,EAAY,QAE3C,MAAMrD,EAAsD,QAAzC,EAA8B,QAA9B,WAAcsD,EAAKI,mBAAW,eAAEzD,iBAAS,uBACtD4D,EAASR,EAAW,OACpBnC,EAAS2C,GACb,QAAgBA,EAAOC,MAAM,KAAKC,KAAK1D,IAAOA,IAAI,YAAaiD,EAAKI,YACpE1D,EAEF,GAAwB,WAApB6B,EAAQ0B,GAAsB,CAChC,QAAqBS,IAAjBV,EAAKlD,cAA0C4D,IAAjBV,EAAKnC,cAAwC6C,IAAfhE,EAC9D,MAAM,IAAIoD,MAAM,oDAClB,MACMjD,EAAc,EADG,QAASH,GAAc,KAE9C,IAAK,IAAIM,EAAI,EAAGA,GAAKgD,EAAKlD,QAASE,IACjCH,EAAYI,KAAKJ,EAAYA,EAAYK,OAAS,GAAK,GAEzD8C,EAAKtC,SAAW,IAAIiD,EAAA,EAAS,CAC3BhD,OAAQ,CAACjB,EAAW,GAAIA,EAAW,IACnCkB,SACAC,QAASmC,EAAKnC,QACdhB,e,MAGiBmD,EAGRpC,OAASlB,EAKtB,OAHAsD,EAAKZ,KAAOA,EACZY,EAAKxC,IAAM2B,EAAI3B,IAERwC,CAAI,GAEjB,C,mFCrKO,MAAMY,UAAsBC,EAAA,GAajCC,YAAYrC,G,UACVsC,QAEAtC,EAAUA,GAAoB,CAAC,EAE/BuC,KAAKC,eAAiB,IAAIC,EAAA,EAAW,CACnCC,KAAM,GACNC,MAAO,gBAGTJ,KAAKK,cAAgB5C,EAAQ6C,aAAe7C,EAAQ6C,aAAe,KACnEN,KAAKO,cAAoC,QAApB,EAAA9C,EAAQ+C,oBAAY,QAAI,WAC7CR,KAAKS,QAAwB,QAAd,EAAAhD,EAAQrB,cAAM,QAAI,KACjC4D,KAAKU,YAAcjD,EAAQkD,WAC3BX,KAAKpD,OAAuB,QAAd,EAAAa,EAAQb,cAAM,QAAI,KAMhCoD,KAAKY,oBAAsB,CACzB,0BAEJ,CAEAC,YAAYvE,EAA2BmB,GACrC,MAAMqD,EAAaxE,EAAOwE,WAE1B,IAAIC,EACCf,KAAKU,aAGRK,EAAKD,EAAWd,KAAKU,oBACdI,EAAWd,KAAKU,cAHvBK,EAAKzE,EAAOyE,GAKd,MAAMC,EAAS1E,EAAO2E,eAChBC,EAAkB,GAClBC,EAAO,GAEPC,EAAyBxB,EAAcyB,QAAQL,EAAO9E,OAAS,EAAI,QAAU,QAAQI,EAAO8E,MAClG,GAAa,YAATA,EAEF,OAAO,KAET,IAAK,IAAIE,EAAI,EAAGA,EAAIN,EAAO9E,OAAQoF,IACjC,GAAwB,GAApBN,EAAOM,GAAGpF,OAAd,CAEA,IAAK,IAAIqF,EAAI,EAAGA,EAAIP,EAAOM,GAAGpF,OAAQqF,IACpCL,EAAgBjF,KAAK+E,EAAOM,GAAGC,GAAG3C,EAAGoC,EAAOM,GAAGC,GAAGC,GAEpDL,EAAKlF,KAAKiF,EAAgBhF,OAJhB,CAOZ,MAAMuF,EAAU,IAAIzB,KAAKK,cAAce,EAAMF,EAAiBC,EAAML,EAAYC,GAGhF,OAFAU,EAAQC,UAAUjE,aAAO,EAAPA,EAASwC,gBAEpBwB,CACT,CAEAE,aAAarF,EAAqBmB,GAChC,MAAMrB,EAAS4D,KAAKS,QAEdmB,EAA0B,GAC1BC,EAAO,IAAI,EAAAC,WAAW,IAAI,IAAJ,CAAa,YAAYxF,KACrDmB,EAAUuC,KAAK+B,aAAatE,GAC5B,MAAMwC,GAAiB,QAAcxC,aAAO,EAAPA,EAASwC,gBACxCrD,EAASa,aAAO,EAAPA,EAASb,OACxB,IAAKqD,IAAmBxC,IAAYb,EAClC,MAAM,IAAIkC,MAAM,0CAClBmB,EAAe+B,eAAepF,GAC9BqD,EAAegC,UAAU,CAAC,EAAG,EAAGjC,KAAKpD,OAAQoD,KAAKpD,SAClDa,EAAQwC,eAAiBA,EAEzB,IAAK,MAAMiC,KAAaC,OAAOC,KAAKP,EAAKzF,QAAS,CAChD,GAAIA,IAAWA,EAAOiG,SAASH,GAC7B,SAEF,MAAMI,EAAIT,EAAKzF,OAAO8F,GACtB,IAAK,IAAIK,EAAM,EAAGA,EAAMD,EAAEpG,OAAQqG,IAAO,CACvC,MAAMC,EAAgBF,EAAEb,QAAQc,GAC1Bd,EAAUzB,KAAKa,YAAY2B,EAAe/E,GAChDgE,EAAQgB,gBAAgBC,MAAQR,EAChCN,EAAS3F,KAAKwF,E,EAIlB,OAAOG,CACT,CAEAe,iBACE,OAAO3C,KAAKC,cACd,EAhGO,EAAAoB,QAAU,CACfuB,KAAM,CAAC,UAAW,QAAS,aAAc,WACzCC,MAAO,CAAC,UAAW,aAAc,kBAAmB,YCTjD,MAAMC,UAA4BhB,EAAA,EAMvChC,YAAYrC,G,MACV,QAAoBiC,IAAhBjC,EAAQjB,UAAsCkD,IAAjBjC,EAAQW,KACvC,MAAM,IAAIU,MAAM,oBAEhBiB,MAAM,OAAD,wBACFtC,GAAO,CACVjB,SAAKkD,EACLT,OAAQ,IAAIW,EAAc,CACxBxD,OAAQqB,EAAQrB,SAGlB2G,gBAAkBC,GAAsB,GAAGvF,EAAQjB,OAAOwG,EAAO,MAAMA,EAAO,MAAMA,EAAO,QAG7FhD,KAAKiD,oBAAoBjD,KAAKkD,WAAW5F,KAAK0C,OAE9CA,KAAK5B,KAAmB,QAAZ,EAAAX,EAAQW,YAAI,SAAI,QAAqBZ,EAAgBC,IAC9DY,MAAMD,GAASA,EAAKE,KAAKb,EAAQjB,KAAK6B,MAAK,IAAMD,KACtD,CAEQ8E,WAAWC,EAAaC,GAE9B,MAAMvB,EAAOsB,EACblG,EAAM,eAAgB,CAAC4E,EAAKwB,UAAU,GAAIxB,EAAKwB,UAAU,GAAIxB,EAAKwB,UAAU,KAC5ExB,EAAKyB,WAAU,CAAC1G,EAAQ2G,EAAYnE,KAClCY,KAAK5B,KACFC,MAAME,GACLA,EAAEC,KACA,kGACA,CACEgF,MAAO3B,EAAKwB,UAAU,GACtBI,KAAM5B,EAAKwB,UAAU,GACrBK,MAAO,GAAK7B,EAAKwB,UAAU,IAAM,EAAIxB,EAAKwB,UAAU,OAGzDhF,MAAMtC,IACL,GAAIA,GAAKA,EAAE,IAAMA,EAAE,GAAG8C,IAAI,GAAI,CAC5B,MACM+C,EADSC,EAAK8B,YACIhC,aAAa5F,EAAE,GAAG8C,IAAI,GAAI,CAChDjC,SACAgH,kBAAmBxE,IAIrB,OAFAyC,EAAKgC,YAAYjC,QACjBC,EAAKiC,OAAOlC,EAAUxC,E,CAGxB,MAAM,IAAIN,MAAM,eAAe+C,EAAKwB,YAAY,IAEjDU,OAAOC,IACN/G,EAAM+G,GACNnC,EAAKoC,SAAS,GACd,GAER,CAEAC,kBACE,OAAOlE,KAAK5B,KAAKC,MAAME,GAAMA,EAAE4F,SACjC,E,uBCjEK,MAAMC,UAA4B,IAMvCtE,YAAYrC,G,MACV,QAAoBiC,IAAhBjC,EAAQjB,UAAsCkD,IAAjBjC,EAAQW,KACvC,MAAM,IAAIU,MAAM,oBAElBiB,MAAM,OAAD,wBACAtC,GAAO,CACVjB,SAAKkD,EAELqD,gBAAkBC,GAAsB,GAAGvF,EAAQjB,OAAOwG,EAAO,MAAMA,EAAO,MAAMA,EAAO,QAG7FhD,KAAKiD,oBAAoBjD,KAAKkD,WAAW5F,KAAK0C,OAE9CA,KAAK5B,KAAmB,QAAZ,EAAAX,EAAQW,YAAI,SAAI,QAAqBZ,EAAgBC,IAC9DY,MAAMD,GAASA,EAAKE,KAAKb,EAAQjB,KAAK6B,MAAK,IAAMD,KACtD,CAGQ8E,WAAWrB,EAAYuB,GAC7BnG,EAAM,eAAgB,CAAC4E,EAAKwB,UAAU,GAAIxB,EAAKwB,UAAU,GAAIxB,EAAKwB,UAAU,KAC5E,MAAMgB,EAASxC,EAAmByC,WAClCtE,KAAK5B,KACFC,MAAME,GACLA,EAAEC,KACA,kGACA,CACEgF,MAAO3B,EAAKwB,UAAU,GACtBI,KAAM5B,EAAKwB,UAAU,GACrBK,MAAO,GAAK7B,EAAKwB,UAAU,IAAM,EAAIxB,EAAKwB,UAAU,OAGzDhF,MAAMtC,IACL,KAAIA,GAAKA,EAAE,IACLA,EAAE,GAAG8C,IAAI,aAAc0F,YAO7B,MAAM,IAAIzF,MAAM,eAAe+C,EAAKwB,aARpC,CAEI,MAAMmB,EAAO,IAAIC,KAAK,CAAC1I,EAAE,GAAG8C,IAAI,KAC1B6F,EAAWC,IAAIC,gBAAgBJ,GACrCH,EAAMQ,IAAMH,C,CAIgC,IAEjDX,OAAOC,IACN/G,EAAM+G,GACNnC,EAAKiD,SAASC,EAAA,QAAgB,GAEpC,CAEAb,kBACE,OAAOlE,KAAK5B,KAAKC,MAAME,GAAMA,EAAE4F,SACjC,E,gDC5BF,MAAMa,UAAY,IAIhBlF,YAAYrC,GAGV,IAAIhB,EAEFA,OAD2BiD,KAH7BjC,EAAUA,GAAW,CAAC,GAGVhB,aACKgB,EAAQhB,aAER,CAjDnB,4GAoDE,MAAMwI,OACoBvF,IAAxBjC,EAAQwH,YAA4BxH,EAAQwH,YAAc,YAEtDzI,OACYkD,IAAhBjC,EAAQjB,IACJiB,EAAQjB,IACR,iDAENuD,MAAM,CACJtD,aAAcA,EACdyI,yBAAyB,EACzBlH,UAAWP,EAAQO,UACnBiH,YAAaA,EACbE,YAAa1H,EAAQ0H,YACrBrJ,aAA6B4D,IAApBjC,EAAQ3B,QAAwB2B,EAAQ3B,QAAU,GAC3DsJ,YAA2B1F,IAAnBjC,EAAQ2H,QAAuB3H,EAAQ2H,OAC/CC,2BAA4B5H,EAAQ4H,2BACpCC,iBAAkB7H,EAAQ6H,iBAC1BC,WAAY9H,EAAQ8H,WACpB/I,IAAKA,EACLgJ,MAAO/H,EAAQ+H,MACfC,WAAYhI,EAAQgI,YAExB,EAGF,S","sources":["webpack://ol-mbtiles/./examples/code/sync-init.ts","webpack://ol-mbtiles/./src/debug.ts","webpack://ol-mbtiles/./src/mbtiles.ts","webpack://ol-mbtiles/./src/mbtiles-format.ts","webpack://ol-mbtiles/./src/mbtiles-vector-source.ts","webpack://ol-mbtiles/./src/mbtiles-raster-source.ts","webpack://ol-mbtiles/./node_modules/ol/source/OSM.js"],"sourcesContent":["import Map from 'ol/Map.js';\nimport TileLayer from 'ol/layer/Tile.js';\nimport OSM from 'ol/source/OSM';\nimport View from 'ol/View.js';\nimport ImageTileLayer from 'ol/layer/Tile';\nimport TileDebug from 'ol/source/TileDebug';\nimport { fromLonLat, get as getProjection } from 'ol/proj';\nimport { Extent, getWidth } from 'ol/extent';\n\nimport { MBTilesRasterSource } from 'ol-mbtiles';\nimport TileGrid from 'ol/tilegrid/TileGrid';\n\nconst projExtent = getProjection('EPSG:3857')?.getExtent() as Extent;\nconst baseResolution = getWidth(projExtent) / 256;\nfunction resolutions(maxZoom: number): number[] {\n  const r = [ baseResolution ];\n  for (let z = 1; z <= maxZoom; z++)\n    r.push(r[r.length - 1] / 2);\n  return r;\n}\n\n// Raster MBTiles from\n// https://www.data.gouv.fr/en/datasets/pyramide-de-tuiles-depuis-la-bd-ortho-r/\n// 240MB original file\n\n// This is a synchronous function\nexport default function () {\n  return new Map({\n    target: 'map',\n    layers: [\n      new TileLayer({\n        zIndex: 20,\n        source: new TileDebug()\n      }),\n      new TileLayer({\n        zIndex: 0,\n        source: new OSM(),\n      }),\n      new ImageTileLayer({\n        zIndex: 10,\n        opacity: 0.5,\n        source: new MBTilesRasterSource({\n          url: 'https://velivole.b-cdn.net/tiles-RGR92UTM40S.mbtiles',\n          attributions: [\n            'IGN / Mapotempo',\n            'BD Ortho 5m',\n            'https://www.data.gouv.fr/en/datasets/pyramide-de-tuiles-depuis-la-bd-ortho-r/'\n          ],\n          tileGrid: new TileGrid({\n            origin: [projExtent[0], projExtent[2]],\n            // These must be known\n            extent: [\n              6141145.607336855,\n              -2443028.8860581857,\n              6216858.872510456,\n              -2366876.107971946\n            ],\n            minZoom: 9,\n            resolutions: resolutions(16)\n          }),\n        }),\n      })\n    ],\n    view: new View({\n      center: fromLonLat([55.47437, -21.08468]),\n      zoom: 9\n    }),\n  });\n}","declare const OL_MBTILES_DEBUG: string;\nconst debugEnabled = (typeof OL_MBTILES_DEBUG !== 'undefined' && OL_MBTILES_DEBUG) ||\n  (typeof process !== 'undefined' && typeof process?.env?.OL_MBTILES_DEBUG !== 'undefined' && process.env.OL_MBTILES_DEBUG);\n\nexport const debug = debugEnabled ? console.debug.bind(console) : () => undefined;\n","import { createSQLiteHTTPPool, SQLiteHTTPPool, VFSHTTP } from 'sqlite-wasm-http';\n\nimport { Options as ImageTileOptions } from 'ol/source/TileImage.js';\nimport { Options as VectorTileOptions } from 'ol/source/VectorTile.js';\nimport { get as getProjection, transformExtent } from 'ol/proj.js';\nimport { getWidth } from 'ol/extent.js';\nimport TileGrid from 'ol/tilegrid/TileGrid.js';\nimport { debug } from './debug';\n\n/**\n * Options for creating a MBTilesRasterSource\n */\nexport interface MBTilesRasterOptions extends ImageTileOptions {\n  /**\n   * Number of parallel workers to use for retrieving tiles, @default 4\n   */\n  sqlWorkers?: number;\n  /**\n   * List of layer names to selectively include, @default everything\n   */\n  layers?: string[];\n\n  tileUrlFunction?: never;\n  tileLoadFunction?: never;\n\n  /**\n   * Alternative method of specifying minZoom, mutually exclusive with tileGrid, requires explicit projection\n   */\n  minZoom?: number;\n\n  /**\n   * Alternative method of specifying minZoom, mutually exclusive with tileGrid, requires explicit projection\n   */\n  maxZoom?: number;\n\n  /**\n   * Optional tile grid, refer to the Openlayers manual\n   */\n  tileGrid?: TileGrid;\n\n  /**\n   * Optional already open SQLiteHTTP pool (mutually exclusive with url)\n   */\n  pool?: Promise<SQLiteHTTPPool>;\n}\n\n/**\n * Options for creating a MBTilesVectorSource\n */\nexport interface MBTilesVectorOptions extends VectorTileOptions {\n  /**\n   * Number of parallel workers to use for retrieving tiles, @default 4\n   */\n  sqlWorkers?: number;\n  /**\n   * List of layer names to selectively include, @default everything\n   */\n  layers?: string[];\n\n  /**\n   * Optional already open SQLiteHTTP pool (mutually exclusive with url)\n   */\n  pool?: Promise<SQLiteHTTPPool>;\n\n  tileUrlFunction?: never;\n  tileLoadFunction?: never;\n  format?: never;\n}\n\n/**\n * Shared options for all MBTiles\n */\nexport interface SQLOptions {\n  /**\n   * URL of the remote MBTiles source\n   */\n  url: string;\n  /**\n   * Number of parallel workers to use for retrieving tiles, @default 4\n   */\n  sqlWorkers?: number;\n\n  /**\n   * Maximum expected page size in bytes for SQLite3 files, @default 4096\n   */\n  maxSqlPageSize?: number;\n\n  /**\n   * Memory to use for SQLite cache in KB, @default 4096\n   */\n  sqlCacheSize?: number;\n\n  /**\n   * Use a specific backend type, @default 'shared'\n   */\n  backendType?: VFSHTTP.Options['backendType'];\n}\n\nexport type MBTilesOptions = MBTilesVectorOptions | MBTilesRasterOptions;\n\nconst formats: Record<string, 'raster' | 'vector'> = {\n  'jpg': 'raster',\n  'png': 'raster',\n  'webp': 'raster',\n  'pbf': 'vector',\n  'mvt': 'vector'\n};\n\nexport function httpPoolOptions(options?: SQLOptions) {\n  return {\n    workers: options?.sqlWorkers ?? 4,\n    httpOptions: {\n      backendType: options?.backendType,\n      maxPageSize: options?.maxSqlPageSize ?? 4096,\n      cacheSize: options?.sqlCacheSize ?? 4096\n    } as VFSHTTP.Options,\n  };\n}\n\n/**\n * Automatically import MBTiles metadata and return an options object\n * compatible with the source constructors.\n * \n * @param {(MBTilesRasterOptions | MBTilesVectorOptions) & SQLOptions} opt Any MBTiles{Raster|Vector}Source options to be overridden\n * @param {string} opt.url URL of the remote tileset\n * @returns {(MBTilesRasterOptions | MBTilesVectorOptions)}\n */\nexport function importMBTiles<T extends MBTilesOptions>(opt: SQLOptions & T): Promise<T & SQLOptions> {\n  const pool: Promise<SQLiteHTTPPool> = createSQLiteHTTPPool(httpPoolOptions(opt))\n    .then((pool) => pool.open(opt.url).then(() => pool));\n\n  return pool\n    .then((p) => p.exec('SELECT name,value FROM metadata'))\n    .then((r) => {\n      if (r && r.length) {\n        // Transform an array of form [ ['name', 'value' ], ... ] to object\n        const data = r.reduce((a, x) => {\n          a[x.row[0] as string] = x.row[1] as string;\n          return a;\n        }, {} as Record<string, string>);\n        debug('Loaded metadata', data);\n        return data;\n      }\n      throw new Error('Could not load metadata');\n    })\n    .then((md) => {\n      const opts = {...opt} as T & SQLOptions;\n\n      const format = (md['format'] as string)?.toLowerCase?.();\n      if (!formats[format])\n        console.warn('Unknown tile format', format);\n\n      // Sometimes, I wonder if Mapbox doesn't hold a patent or some\n      // other kind of investment related to everyone using 3857\n      opts.projection = opt.projection ?? 'EPSG:3857';\n      opts.attributions = (md.attribution ?? md.description) as string;\n      opts.maxZoom = opt.maxZoom ?? +md['maxzoom'];\n      opts.minZoom = opt.minZoom ?? +md['minzoom'];\n\n      const projExtent = getProjection(opts.projection)?.getExtent?.();\n      const bounds = md['bounds'] as string;\n      const extent = bounds ?\n        transformExtent(bounds.split(',').map((r) => +r), 'EPSG:4326', opts.projection) :\n        projExtent;\n\n      if (formats[format] === 'raster') {\n        if (opts.maxZoom === undefined || opts.minZoom === undefined || projExtent === undefined)\n          throw new Error('Cannot determine tilegrid, need minZoom, maxZoom');\n        const baseResolution = getWidth(projExtent) / 256;\n        const resolutions = [baseResolution];\n        for (let z = 1; z <= opts.maxZoom; z++)\n          resolutions.push(resolutions[resolutions.length - 1] / 2);\n\n        opts.tileGrid = new TileGrid({\n          origin: [projExtent[0], projExtent[2]],\n          extent,\n          minZoom: opts.minZoom,\n          resolutions\n        });\n      } else {\n        const vectorOpts = opts as MBTilesVectorOptions;\n        // Alas VectorTileSource in Openlayers does not support\n        // constraining the extent while keeping the origin\n        vectorOpts.extent = projExtent;\n      }\n      opts.pool = pool;\n      opts.url = opt.url;\n\n      return opts;\n    });\n}\n","import Protobuf from 'pbf';\nimport { VectorTile, VectorTileFeature } from '@mapbox/vector-tile';\nimport pako from 'pako';\n\nimport FeatureFormat, { ReadOptions } from 'ol/format/Feature.js';\nimport Projection from 'ol/proj/Projection.js';\nimport RenderFeature from 'ol/render/Feature.js';\nimport { FeatureLike } from 'ol/Feature.js';\nimport { get as getProjection } from 'ol/proj.js';\nimport { Type } from 'ol/geom/Geometry.js';\n\ndeclare module '@mapbox/vector-tile' {\n  interface VectorTileFeature {\n    toGeoJSON(x: number, y: number, z: number, project?: (xy: [number, number]) => [number, number]): GeoJSON.Feature;\n  }\n}\n\nexport interface Options {\n  layers?: string[];\n  featureClass?: typeof RenderFeature;\n  geometryName?: string;\n  idProperty?: string;\n  extent?: number;\n}\n\nexport class MBTilesFormat extends FeatureFormat {\n  dataProjection: Projection;\n  private featureClass_: typeof RenderFeature;\n  private geometryName_: string;\n  private layers_: string[] | null;\n  private idProperty_: string | undefined;\n  supportedMediaTypes: string[];\n  extent: number;\n  static MBTypes = {\n    mono: ['Unknown', 'Point', 'LineString', 'Polygon' ],\n    multi: ['Unknown', 'MultiPoint', 'MultiLineString', 'Polygon']\n   } as Record<'mono' | 'multi', (Type | 'Unknown')[]>;\n\n  constructor(options?: Options) {\n    super();\n\n    options = options ? options : {};\n\n    this.dataProjection = new Projection({\n      code: '',\n      units: 'tile-pixels',\n    });\n\n    this.featureClass_ = options.featureClass ? options.featureClass : RenderFeature;\n    this.geometryName_ = options.geometryName ?? 'Geometry';\n    this.layers_ = options.layers ?? null;\n    this.idProperty_ = options.idProperty;\n    this.extent = options.extent ?? 4096;\n\n    /*\n     * As this is the very first time MBTiles will be distributed by HTTP\n     * there is still no official MIME type\n     */\n    this.supportedMediaTypes = [\n      'application/vnd-mbtiles'\n    ];\n  }\n\n  readFeature(source: VectorTileFeature, options?: ReadOptions): FeatureLike {\n    const properties = source.properties;\n\n    let id: string | number;\n    if (!this.idProperty_) {\n      id = source.id;\n    } else {\n      id = properties[this.idProperty_] as string | number;\n      delete properties[this.idProperty_];\n    }\n    const points = source.loadGeometry();\n    const flatCoordinates = [] as number[];\n    const ends = [] as number[];\n\n    const type: Type | 'Unknown' = MBTilesFormat.MBTypes[points.length > 1 ? 'multi' : 'mono'][source.type];\n    if (type === 'Unknown')\n    // TODO: fix in Openlayers\n      return null as unknown as FeatureLike;\n\n    for (let i = 0; i < points.length; i++) {\n      if (points[i].length == 0)\n        continue;\n      for (let j = 0; j < points[i].length; j++) {\n        flatCoordinates.push(points[i][j].x, points[i][j].y);\n      }\n      ends.push(flatCoordinates.length);\n    }\n\n    const feature = new this.featureClass_(type, flatCoordinates, ends, properties, id);\n    feature.transform(options?.dataProjection);\n\n    return feature;\n  }\n\n  readFeatures(source: ArrayBuffer, options?: ReadOptions): FeatureLike[] {\n    const layers = this.layers_;\n\n    const features: FeatureLike[] = [];\n    const tile = new VectorTile(new Protobuf(pako.ungzip(source)));\n    options = this.adaptOptions(options);\n    const dataProjection = getProjection(options?.dataProjection);\n    const extent = options?.extent;\n    if (!dataProjection || !options || !extent)\n      throw new Error('Cannot determine the projection/extent');\n    dataProjection.setWorldExtent(extent);\n    dataProjection.setExtent([0, 0, this.extent, this.extent]);\n    options.dataProjection = dataProjection;\n\n    for (const layerName of Object.keys(tile.layers)) {\n      if (layers && !layers.includes(layerName)) {\n        continue;\n      }\n      const l = tile.layers[layerName];\n      for (let idx = 0; idx < l.length; idx++) {\n        const vectorFeature = l.feature(idx);\n        const feature = this.readFeature(vectorFeature, options);\n        feature.getProperties().layer = layerName;\n        features.push(feature);\n      }\n    }\n\n    return features;\n  }\n\n  readProjection() {\n    return this.dataProjection;\n  }\n}\n","import { createSQLiteHTTPPool, SQLiteHTTPPool } from 'sqlite-wasm-http';\n\nimport VectorTileSource from 'ol/source/VectorTile.js';\nimport VectorTile from 'ol/VectorTile.js';\nimport { TileCoord } from 'ol/tilecoord.js';\nimport Feature from 'ol/Feature.js';\nimport { Geometry } from 'ol/geom.js';\n\nimport { httpPoolOptions, MBTilesVectorOptions, SQLOptions } from './mbtiles';\nimport { MBTilesFormat } from './mbtiles-format';\nimport { debug } from './debug';\nimport Tile from 'ol/Tile';\n\n/**\n * A tile source in a remote .mbtiles file accessible by HTTP\n * \n * WARNING\n * If your application continuously creates and removes MBTilesSource\n * objects, special care must be taken to properly dispose of them.\n * An MBTilesSource creates a thread pool that the JS engine is unable to\n * automatically garbage-collect unless the dispose() method\n * is invoked.\n * If you need to dispose a map that can potentially contain\n * MBTilesSource objects, check loadExample() in\n * https://github.com/mmomtchev/ol-mbtiles/blob/main/examples/index.ts#L15\n */\nexport class MBTilesVectorSource extends VectorTileSource {\n  private pool: Promise<SQLiteHTTPPool>;\n\n  /**\n   * @param {MBTilesVectorOptions} options options\n   */\n  constructor(options: MBTilesVectorOptions & SQLOptions) {\n    if (options.url === undefined && options.pool === undefined)\n      throw new Error('Must specify url');\n\n      super({\n      ...options,\n      url: undefined,\n      format: new MBTilesFormat({\n        layers: options.layers\n      }),\n      // This is required to prevent Openlayers' cache from thinking that all tiles share the same URL\n      tileUrlFunction: (coords: TileCoord) => `${options.url}#${coords[0]}:${coords[1]}:${coords[2]}`\n    });\n\n    this.setTileLoadFunction(this.tileLoader.bind(this));\n\n    this.pool = options.pool ?? createSQLiteHTTPPool(httpPoolOptions(options))\n      .then((pool) => pool.open(options.url).then(() => pool));\n  }\n\n  private tileLoader(_tile: Tile, _url: string) {\n    // TODO fix the type in Openlayers after the war\n    const tile = _tile as VectorTile;\n    debug('loading tile', [tile.tileCoord[0], tile.tileCoord[1], tile.tileCoord[2]]);\n    tile.setLoader((extent, resolution, projection) => {\n      this.pool\n        .then((p) =>\n          p.exec(\n            'SELECT tile_data FROM tiles WHERE zoom_level = $zoom AND tile_column = $col AND tile_row = $row',\n            {\n              $zoom: tile.tileCoord[0],\n              $col: tile.tileCoord[1],\n              $row: (1 << tile.tileCoord[0]) - 1 - tile.tileCoord[2]\n            }\n          ))\n        .then((r) => {\n          if (r && r[0] && r[0].row[0]) {\n            const format = tile.getFormat();\n            const features = format.readFeatures(r[0].row[0], {\n              extent,\n              featureProjection: projection\n            }) as Feature<Geometry>[];\n            tile.setFeatures(features);\n            tile.onLoad(features, projection);\n            return;\n          }\n          throw new Error(`No data for ${tile.tileCoord}`);\n        })\n        .catch((e) => {\n          debug(e);\n          tile.onError();\n        });\n    });\n  }\n\n  disposeInternal() {\n    return this.pool.then((p) => p.close());\n  }\n}\n","import { createSQLiteHTTPPool, SQLiteHTTPPool } from 'sqlite-wasm-http';\n\nimport ImageTileSource from 'ol/source/TileImage.js';\nimport Tile from 'ol/Tile.js';\nimport ImageTile from 'ol/ImageTile.js';\nimport { TileCoord } from 'ol/tilecoord.js';\nimport TileState from 'ol/TileState.js';\n\nimport { httpPoolOptions, MBTilesRasterOptions, SQLOptions } from './mbtiles';\nimport { debug } from './debug';\n\n/**\n * A tile source in a remote .mbtiles file accessible by HTTP\n * \n * WARNING\n * If your application continuously creates and removes MBTilesSource\n * objects, special care must be taken to properly dispose of them.\n * An MBTilesSource creates a thread pool that the JS engine is unable to\n * automatically garbage-collect unless the dispose() method\n * is invoked.\n * If you need to dispose a map that can potentially contain\n * MBTilesSource objects, check loadExample() in\n * https://github.com/mmomtchev/ol-mbtiles/blob/main/examples/index.ts#L15\n */\nexport class MBTilesRasterSource extends ImageTileSource {\n  private pool: Promise<SQLiteHTTPPool>;\n\n  /**\n   * @param {MBTilesRasterOptions} options options\n   */\n  constructor(options: MBTilesRasterOptions & SQLOptions) {\n    if (options.url === undefined && options.pool === undefined)\n      throw new Error('Must specify url');\n\n    super({\n      ...options,\n      url: undefined,\n      // This is required to prevent Openlayers' cache from thinking that all tiles share the same URL\n      tileUrlFunction: (coords: TileCoord) => `${options.url}#${coords[0]}:${coords[1]}:${coords[2]}`\n    });\n\n    this.setTileLoadFunction(this.tileLoader.bind(this));\n\n    this.pool = options.pool ?? createSQLiteHTTPPool(httpPoolOptions(options))\n      .then((pool) => pool.open(options.url).then(() => pool));\n  }\n\n  // TODO fix the tile type in Openlayers\n  private tileLoader(tile: Tile, _url: string) {\n    debug('loading tile', [tile.tileCoord[0], tile.tileCoord[1], tile.tileCoord[2]]);\n    const image = (tile as ImageTile).getImage() as HTMLImageElement;\n    this.pool\n      .then((p) =>\n        p.exec(\n          'SELECT tile_data FROM tiles WHERE zoom_level = $zoom AND tile_column = $col AND tile_row = $row',\n          {\n            $zoom: tile.tileCoord[0],\n            $col: tile.tileCoord[1],\n            $row: (1 << tile.tileCoord[0]) - 1 - tile.tileCoord[2]\n          }\n        ))\n      .then((r) => {\n        if (r && r[0]) {\n          if (r[0].row[0] instanceof Uint8Array) {\n            const blob = new Blob([r[0].row[0] as Uint8Array]);\n            const imageUrl = URL.createObjectURL(blob);\n            image.src = imageUrl;\n            return;\n          }\n        }\n        throw new Error(`No data for ${tile.tileCoord}`);\n      })\n      .catch((e) => {\n        debug(e);\n        tile.setState(TileState.ERROR);\n      });\n  }\n\n  disposeInternal() {\n    return this.pool.then((p) => p.close());\n  }\n}\n","/**\n * @module ol/source/OSM\n */\n\nimport XYZ from './XYZ.js';\n\n/**\n * The attribution containing a link to the OpenStreetMap Copyright and License\n * page.\n * @const\n * @type {string}\n * @api\n */\nexport const ATTRIBUTION =\n  '&#169; ' +\n  '<a href=\"https://www.openstreetmap.org/copyright\" target=\"_blank\">OpenStreetMap</a> ' +\n  'contributors.';\n\n/**\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {number} [cacheSize] Initial tile cache size. Will auto-grow to hold at least the number of tiles in the viewport.\n * @property {null|string} [crossOrigin='anonymous'] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you want to access pixel data with the Canvas renderer.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image for more detail.\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.  By default,\n * linear interpolation is used when resampling.  Set to false to use the nearest neighbor instead.\n * @property {number} [maxZoom=19] Max zoom.\n * @property {boolean} [opaque=true] Whether the layer is opaque.\n * @property {number} [reprojectionErrorThreshold=0.5] Maximum allowed reprojection error (in pixels).\n * Higher values can increase reprojection performance, but decrease precision.\n * @property {import(\"../Tile.js\").LoadFunction} [tileLoadFunction] Optional function to load a tile given a URL. The default is\n * ```js\n * function(imageTile, src) {\n *   imageTile.getImage().src = src;\n * };\n * ```\n * @property {number} [transition=250] Duration of the opacity transition for rendering.\n * To disable the opacity transition, pass `transition: 0`.\n * @property {string} [url='https://tile.openstreetmap.org/{z}/{x}/{y}.png'] URL template.\n * Must include `{x}`, `{y}` or `{-y}`, and `{z}` placeholders.\n * @property {boolean} [wrapX=true] Whether to wrap the world horizontally.\n * @property {number|import(\"../array.js\").NearestDirectionFunction} [zDirection=0]\n * Choose whether to use tiles with a higher or lower zoom level when between integer\n * zoom levels. See {@link module:ol/tilegrid/TileGrid~TileGrid#getZForResolution}.\n */\n\n/**\n * @classdesc\n * Layer source for the OpenStreetMap tile server.\n * @api\n */\nclass OSM extends XYZ {\n  /**\n   * @param {Options} [options] Open Street Map options.\n   */\n  constructor(options) {\n    options = options || {};\n\n    let attributions;\n    if (options.attributions !== undefined) {\n      attributions = options.attributions;\n    } else {\n      attributions = [ATTRIBUTION];\n    }\n\n    const crossOrigin =\n      options.crossOrigin !== undefined ? options.crossOrigin : 'anonymous';\n\n    const url =\n      options.url !== undefined\n        ? options.url\n        : 'https://tile.openstreetmap.org/{z}/{x}/{y}.png';\n\n    super({\n      attributions: attributions,\n      attributionsCollapsible: false,\n      cacheSize: options.cacheSize,\n      crossOrigin: crossOrigin,\n      interpolate: options.interpolate,\n      maxZoom: options.maxZoom !== undefined ? options.maxZoom : 19,\n      opaque: options.opaque !== undefined ? options.opaque : true,\n      reprojectionErrorThreshold: options.reprojectionErrorThreshold,\n      tileLoadFunction: options.tileLoadFunction,\n      transition: options.transition,\n      url: url,\n      wrapX: options.wrapX,\n      zDirection: options.zDirection,\n    });\n  }\n}\n\nexport default OSM;\n"],"names":["projExtent","getExtent","baseResolution","resolutions","maxZoom","r","z","push","length","target","layers","zIndex","source","opacity","url","attributions","tileGrid","origin","extent","minZoom","view","center","zoom","debug","process","env","OL_MBTILES_DEBUG","console","bind","formats","httpPoolOptions","options","workers","sqlWorkers","httpOptions","backendType","maxPageSize","maxSqlPageSize","cacheSize","sqlCacheSize","importMBTiles","opt","pool","then","open","p","exec","data","reduce","a","x","row","Error","md","opts","format","toLowerCase","warn","projection","attribution","description","bounds","split","map","undefined","TileGrid","MBTilesFormat","Feature","constructor","super","this","dataProjection","Projection","code","units","featureClass_","featureClass","geometryName_","geometryName","layers_","idProperty_","idProperty","supportedMediaTypes","readFeature","properties","id","points","loadGeometry","flatCoordinates","ends","type","MBTypes","i","j","y","feature","transform","readFeatures","features","tile","VectorTile","adaptOptions","setWorldExtent","setExtent","layerName","Object","keys","includes","l","idx","vectorFeature","getProperties","layer","readProjection","mono","multi","MBTilesVectorSource","tileUrlFunction","coords","setTileLoadFunction","tileLoader","_tile","_url","tileCoord","setLoader","resolution","$zoom","$col","$row","getFormat","featureProjection","setFeatures","onLoad","catch","e","onError","disposeInternal","close","MBTilesRasterSource","image","getImage","Uint8Array","blob","Blob","imageUrl","URL","createObjectURL","src","setState","TileState","OSM","crossOrigin","attributionsCollapsible","interpolate","opaque","reprojectionErrorThreshold","tileLoadFunction","transition","wrapX","zDirection"],"sourceRoot":""}