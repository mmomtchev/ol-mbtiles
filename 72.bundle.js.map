{"version":3,"file":"72.bundle.js","mappings":"2fAiBe,a,yCACb,OAAO,IAAI,IAAI,CACbA,OAAQ,MACRC,OAAQ,CACN,IAAI,IAAU,CACZC,OAAQ,IAAI,MAEd,IAAI,IAAgB,CAClBA,OAAQ,IAAI,WAA0B,QAAc,CAClDC,IAAK,2EACLF,OAAQ,CAAC,iBAAkB,QAAS,WAAY,UAAW,QAAS,YAEpEG,aAAc,CAAC,WAAY,MAAO,8DAEpCC,MAAO,SAAUC,GACf,OAAQA,EAAQC,IAAI,UAClB,IAAK,QACL,IAAK,WACH,OAAO,KACT,IAAK,iBACH,OAAO,QAAUD,GACnB,IAAK,UACH,OAAO,KACT,IAAK,WACH,OAAO,KACT,IAAK,QACH,OAAO,QAAWA,GACpB,QACE,OAAO,KAEb,KAGJE,KAAM,IAAI,KAAK,CACbC,QAAQ,QAAW,CAAC,GAAI,KACxBC,KAAM,KAGZ,G,6ICpDO,SAASC,EAAUC,EAAcN,GACtC,IAAIO,EACAC,EACJ,OAAQF,GACN,KAAK,EACHC,EAAQ,EACRC,EAAO,MACP,MACF,KAAK,EACHD,EAAQ,EACRC,EAAO,QACP,MACF,KAAK,EACHD,EAAQ,EACRC,EAAO,QACP,MACF,QACED,EAAQ,EACRC,EAAO,QAGXA,GAAQ,yBACR,MAAMC,EAAS,UA0Bf,OAvBc,IAAI,KAAM,CACtBC,MAAO,IAAI,IAAO,CAChBC,KAAM,IAAI,IAAK,CACbC,MAAOH,IAETI,OAAQN,EACRO,OAAQ,IAAI,IAAO,CACjBF,MAAOH,EACPF,MAAOA,MAGXQ,KAAM,IAAI,IAAK,CACbP,KAAMA,EACNO,KAAMf,EAAQC,IAAI,KAClBU,KAAM,IAAI,IAAK,CACbC,MAjBS,YAmBXE,OAAQ,IAAI,IAAO,CACjBF,MAAOH,EACPF,MAAO,OAKf,CAEO,MAAMS,EAAc,IAAI,KAAM,CACnCF,OAAQ,IAAI,IAAO,CACjBF,MAAO,OACPL,MAAO,MAMLU,EAAwC,CAAC,EACzCC,EAAoC,CACxC,SAAY,OACZ,MAAS,OACT,QAAW,QAEAC,EAAgB,IAAI,KAAM,CACrCR,KAAM,IAAI,IAAK,CACbC,MAAO,SAETE,OAAQ,IAAI,IAAO,CACjBF,MAAO,OACPL,MAAO,MAGEa,EAAa,IAAI,KAAM,CAClCT,KAAM,IAAI,IAAK,CACbC,MAAO,cAGES,EAAgB,IAAI,KAAM,CACrCP,OAAQ,IAAI,IAAO,CACjBF,MAAO,UACPL,MAAO,MAGEe,EAAY,SAAUtB,GACjC,MAAMuB,EAAOvB,EAAQC,IAAI,SACnBuB,EAAUxB,EAAQC,IAAI,WACtBwB,EAAWzB,EAAQC,IAAI,YACvByB,EAAWH,EAAO,IAAMC,EAAU,IAAMC,EAC9C,IAAI1B,EAAQkB,EAAeS,GAC3B,IAAK3B,EAAO,CACV,IAAIa,EAAOL,EACPiB,GACFZ,EAAQ,OACRL,EAAQ,IAERK,EAAQM,EAAUK,GAClBhB,EAAgB,WAARgB,EAAoB,IAAM,GAEpCxB,EAAQ,IAAI,KAAM,CAChBe,OAAQ,IAAI,IAAO,CACjBF,MAAOA,EACPL,MAAOA,IAEToB,OAAQF,IAEVR,EAAeS,GAAY3B,CAC7B,CACA,OAAOA,CACT,EACM6B,EAAY,IAAI,KAAM,CAC1BlB,MAAO,IAAI,IAAO,CAChBG,OAAQ,EACRF,KAAM,IAAI,IAAK,CACbC,MAAO,gBAIPiB,EAAa,IAAI,IAAO,CAC5BjB,MAAO,QACPL,MAAO,IAEIuB,EAAa,SAAU9B,GAClC,GAA4B,WAAxBA,EAAQC,IAAI,SACd,OAAO,KACT,GAAID,EAAQC,IAAI,QAAS,CACvB,MAAMF,EAAQ6B,EAAUG,QAOxB,OANAhC,EAAMiC,QAAQ,IAAI,IAAK,CACrBjB,KAAMf,EAAQC,IAAI,QAClBgC,SAAU,EACVzB,KAAM,uBACNM,OAAQe,KAEH9B,CACT,CACA,OAAO,IACT,C,yDC/HImC,E,iIACJ,MAEMC,EADkB,oBAAZC,cAAkL,KAAhE,QAA9EF,EAAiB,OAAZE,cAAgCC,IAAZD,aAAwBC,EAAYD,QAAQE,WAAwBD,IAAPH,OAAmBG,EAAYH,EAAGK,mBAAqCH,QAAQE,IAAIC,iBAC5LC,QAAQL,MAAMM,KAAKD,SAAW,KAAe,EAEpEE,EAAU,CACZ,IAAO,CAAEC,KAAM,SAAUC,KAAM,cAC/B,IAAO,CAAED,KAAM,SAAUC,KAAM,aAC/B,KAAQ,CAAED,KAAM,SAAUC,KAAM,cAChC,IAAO,CAAED,KAAM,UACf,IAAO,CAAEA,KAAM,WAEnB,SAASE,EAAgBC,GACrB,IAAIZ,EAAIa,EAAIC,EACZ,MAAO,CACHC,QAA+F,QAArFf,EAAKY,aAA4CT,EAAYS,EAAQI,kBAA+Bb,IAAPH,EAAmBA,EAAK,EAC/HiB,YAAa,CACTC,YAAaN,aAA4CT,EAAYS,EAAQM,YAC7EC,YAAuG,QAAzFN,EAAKD,aAA4CT,EAAYS,EAAQQ,sBAAmCjB,IAAPU,EAAmBA,EAAK,KACvIQ,UAAmG,QAAvFP,EAAKF,aAA4CT,EAAYS,EAAQU,oBAAiCnB,IAAPW,EAAmBA,EAAK,MAG/I,CASA,SAASS,EAAcC,GACnB,MAAMC,GAAO,QAAqBd,EAAgBa,IAClD,OAAOC,EACFC,MAAMD,GAASA,EAAKE,KAAKH,EAAI7D,KAAK+D,MAAK,IAAMD,MAC7CC,MAAME,GAAMA,EAAEC,KAAK,qCACnBH,MAAMI,IACP,GAAIA,GAAKA,EAAEC,OAAQ,CAEf,MAAMC,EAAOF,EAAEG,QAAO,CAACC,EAAGC,KACtBD,EAAEC,EAAEC,IAAI,IAAMD,EAAEC,IAAI,GACbF,IACR,CAAC,GAEJ,OADAjC,EAAM,kBAAmB+B,GAClBA,CACX,CACA,MAAM,IAAIK,MAAM,0BAA0B,IAEzCX,MAAMY,IACP,IAAItC,EAAIa,EAAIC,EAAIyB,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EACpC,MAAMC,EAAOC,OAAOC,OAAO,CAAC,EAAGvB,GACzBwB,EAAkG,QAAxFnC,EAA6B,QAAvBb,EAAKsC,EAAW,cAAsBnC,IAAPH,OAAmBG,EAAYH,EAAGiD,mBAAgC9C,IAAPU,OAAmBV,EAAYU,EAAGqC,KAAKlD,GAClJQ,EAAQwC,IACT1C,QAAQ6C,KAAK,sBAAuBH,GAGxCH,EAAKO,WAAuC,QAAzBtC,EAAKU,EAAI4B,kBAA+BjD,IAAPW,EAAmBA,EAAK,YAC5E+B,EAAKjF,aAA0C,QAAzB2E,EAAKD,EAAGe,mBAAgClD,IAAPoC,EAAmBA,EAAKD,EAAGgB,YAClFT,EAAKU,QAAiC,QAAtBf,EAAKhB,EAAI+B,eAA4BpD,IAAPqC,EAAmBA,GAAMF,EAAY,QACnFO,EAAKW,QAAiC,QAAtBf,EAAKjB,EAAIgC,eAA4BrD,IAAPsC,EAAmBA,GAAMH,EAAY,QACnF,MAAMmB,EAA4G,QAA9Fd,EAAqC,QAA/BD,GAAK,QAAIG,EAAKO,mBAAgCjD,IAAPuC,OAAmBvC,EAAYuC,EAAGgB,iBAA8BvD,IAAPwC,OAAmBxC,EAAYwC,EAAGO,KAAKR,GAC3JiB,EAASrB,EAAW,OACpBsB,EAASD,GACX,QAAgBA,EAAOE,MAAM,KAAKC,KAAKhC,IAAOA,IAAI,YAAae,EAAKO,YACpEK,EACJ,GAA6B,WAAzBjD,EAAQwC,GAAQvC,KAAmB,CACnC,QAAqBN,IAAjB0C,EAAKU,cAA0CpD,IAAjB0C,EAAKW,cAAwCrD,IAAfsD,EAC5D,MAAM,IAAIpB,MAAM,oDACpB,MACM0B,EAAc,EADG,QAASN,GAAc,KAE9C,IAAK,IAAIO,EAAI,EAAGA,GAAKnB,EAAKU,QAASS,IAC/BD,EAAYE,KAAKF,EAAYA,EAAYhC,OAAS,GAAK,GAC3D,MAAMrB,EAAuC,QAA/BkC,EAAKpC,EAAQwC,GAAQtC,YAAyBP,IAAPyC,EAAmBA,EAAKI,EAC7EH,EAAKnC,KAAOA,EACZmC,EAAKqB,SAAW,IAAI,IAAS,CACzBC,OAAQ,CAACV,EAAW,GAAIA,EAAW,IACnCG,SACAJ,QAASX,EAAKW,QACdO,eAER,MAEuBlB,EAGRe,OAASH,EAIxB,OAFAZ,EAAKpB,KAAOA,EACZoB,EAAKlF,IAAM6D,EAAI7D,IACRkF,CAAI,IAEVuB,OAAOC,GAAM5C,EAAKC,MAAME,GAAMA,EAAE0C,UAAS5C,MAAK,IAAM6C,QAAQC,OAAOH,MAC5E,CAEA,MAAMI,UAAsB,KACxB,WAAAC,CAAY9D,GACR,IAAIZ,EAAIa,EAAIC,EACZ6D,QACA/D,EAAUA,GAAoB,CAAC,EAC/BgE,KAAKC,eAAiB,IAAI,IAAW,CACjCC,KAAM,GACNC,MAAO,gBAEXH,KAAKI,cAAgBpE,EAAQqE,aAAerE,EAAQqE,aAAe,KACnEL,KAAKM,cAAgD,QAA/BlF,EAAKY,EAAQuE,oBAAiChF,IAAPH,EAAmBA,EAAK,WACrF4E,KAAKQ,QAAoC,QAAzBvE,EAAKD,EAAQnD,cAA2B0C,IAAPU,EAAmBA,EAAK,KACzE+D,KAAKS,YAAczE,EAAQ0E,WAC3BV,KAAKhB,OAAmC,QAAzB9C,EAAKF,EAAQgD,cAA2BzD,IAAPW,EAAmBA,EAAK,KAKxE8D,KAAKW,oBAAsB,CACvB,0BAER,CACA,WAAAC,CAAY9H,EAAQkD,GAChB,MAAM6E,EAAa/H,EAAO+H,WAC1B,IAAIC,EACCd,KAAKS,aAINK,EAAKD,EAAWb,KAAKS,oBACdI,EAAWb,KAAKS,cAJvBK,EAAKhI,EAAOgI,GAMhB,MAAMC,EAASjI,EAAOkI,eAChBC,EAAkB,GAClBC,EAAO,GACPrF,EAAOgE,EAAcsB,QAAQJ,EAAO5D,OAAS,EAAI,QAAU,QAAQrE,EAAO+C,MAChF,GAAa,YAATA,EACA,OAAO,KACX,IAAK,IAAIuF,EAAI,EAAGA,EAAIL,EAAO5D,OAAQiE,IAC/B,GAAwB,GAApBL,EAAOK,GAAGjE,OAAd,CAEA,IAAK,IAAIkE,EAAI,EAAGA,EAAIN,EAAOK,GAAGjE,OAAQkE,IAClCJ,EAAgB5B,KAAK0B,EAAOK,GAAGC,GAAG9D,EAAGwD,EAAOK,GAAGC,GAAGC,GAEtDJ,EAAK7B,KAAK4B,EAAgB9D,OAJd,CAMhB,MAAMjE,EAAU,IAAI8G,KAAKI,cAAcvE,EAAMoF,EAAiBC,EAAM,EAAGL,EAAYC,GAGnF,OAFK9E,aAA4CT,EAAYS,EAAQiE,iBAAmB,cAAe/G,GACnGA,EAAQqI,UAAUvF,aAA4CT,EAAYS,EAAQiE,gBAC/E/G,CACX,CACA,YAAAsI,CAAa1I,EAAQkD,GACjB,MAAMnD,EAASmH,KAAKQ,QACdiB,EAAW,GACXC,EAAO,IAAI,EAAAC,WAAW,IAAI,IAAS,YAAY7I,KACrDkD,EAAUgE,KAAK4B,aAAa5F,GAC5B,MAAMiE,GAAiB,QAAIjE,aAA4CT,EAAYS,EAAQiE,gBACrFjB,EAAShD,aAA4CT,EAAYS,EAAQgD,OAC/E,IAAKiB,IAAmBjE,IAAYgD,EAChC,MAAM,IAAIvB,MAAM,0CACpBwC,EAAe4B,eAAe7C,GAC9BiB,EAAe6B,UAAU,CAAC,EAAG,EAAG9B,KAAKhB,OAAQgB,KAAKhB,SAClDhD,EAAQiE,eAAiBA,EACzB,IAAK,MAAM8B,KAAa7D,OAAO8D,KAAKN,EAAK7I,QAAS,CAC9C,GAAIA,IAAWA,EAAOoJ,SAASF,GAC3B,SAEJ,MAAMG,EAAIR,EAAK7I,OAAOkJ,GACtB,IAAK,IAAII,EAAM,EAAGA,EAAMD,EAAE/E,OAAQgF,IAAO,CACrC,MAAMC,EAAgBF,EAAEhJ,QAAQiJ,GAC1BjJ,EAAU8G,KAAKY,YAAYwB,EAAepG,GAChD9C,EAAQmJ,gBAAgBC,MAAQP,EAChCN,EAASpC,KAAKnG,EAClB,CACJ,CACA,OAAOuI,CACX,CACA,cAAAc,GACI,OAAOvC,KAAKC,cAChB,EAEJJ,EAAcsB,QAAU,CACpBqB,KAAM,CAAC,UAAW,QAAS,aAAc,WACzCC,MAAO,CAAC,UAAW,aAAc,kBAAmB,YAgBxD,MAAMC,UAA4B,IAI9B,WAAA5C,CAAY9D,GACR,IAAIZ,EACJ,QAAoBG,IAAhBS,EAAQjD,UAAsCwC,IAAjBS,EAAQa,KACrC,MAAM,IAAIY,MAAM,oBACpBsC,MAAM7B,OAAOC,OAAOD,OAAOC,OAAO,CAAC,EAAGnC,GAAU,CAAEjD,SAAKwC,EAAW6C,OAAQ,IAAIyB,EAAc,CACpFhH,OAAQmD,EAAQnD,SAGpB8J,gBAAkBC,GAAW,GAAG5G,EAAQjD,OAAO6J,EAAO,MAAMA,EAAO,MAAMA,EAAO,QACpF5C,KAAK6C,oBAAoB7C,KAAK8C,WAAWnH,KAAKqE,OAC9CA,KAAKnD,KAA+B,QAAvBzB,EAAKY,EAAQa,YAAyBtB,IAAPH,EAAmBA,GAAK,QAAqBW,EAAgBC,IACpGc,MAAMD,GAASA,EAAKE,KAAKf,EAAQjD,KAAK+D,MAAK,IAAMD,KAC1D,CACA,UAAAiG,CAAWC,EAAOC,GACd,MAAMtB,EAAOqB,EACb1H,EAAM,eAAgB,CAACqG,EAAKuB,UAAU,GAAIvB,EAAKuB,UAAU,GAAIvB,EAAKuB,UAAU,KAC5EvB,EAAKwB,WAAU,CAAClE,EAAQmE,EAAY3E,KAChCwB,KAAKnD,KACAC,MAAME,GAAMA,EAAEC,KAAK,kGAAmG,CACvHmG,MAAO1B,EAAKuB,UAAU,GACtBI,KAAM3B,EAAKuB,UAAU,GACrBK,MAAO,GAAK5B,EAAKuB,UAAU,IAAM,EAAIvB,EAAKuB,UAAU,OAEnDnG,MAAMI,IACP,GAAIA,GAAKA,EAAE,IAAMA,EAAE,GAAGM,IAAI,GAAI,CAC1B,MACMiE,EADSC,EAAK6B,YACI/B,aAAatE,EAAE,GAAGM,IAAI,GAAI,CAC9CwB,SACAwE,kBAAmBhF,IAIvB,OAFAkD,EAAK+B,YAAYhC,QACjBC,EAAKgC,OAAOjC,EAAUjD,EAE1B,CACA,MAAM,IAAIf,MAAM,eAAeiE,EAAKuB,YAAY,IAE/CzD,OAAOC,IACRpE,EAAMoE,GACNiC,EAAKiC,SAAS,GAChB,GAEV,CACA,eAAAC,GACI,OAAO5D,KAAKnD,KAAKC,MAAME,GAAMA,EAAE0C,SACnC,EAgBJ,MAAMmE,UAA4B,IAI9B,WAAA/D,CAAY9D,GACR,IAAIZ,EACJ,QAAoBG,IAAhBS,EAAQjD,UAAsCwC,IAAjBS,EAAQa,KACrC,MAAM,IAAIY,MAAM,oBACpBsC,MAAM7B,OAAOC,OAAOD,OAAOC,OAAO,CAAC,EAAGnC,GAAU,CAAEjD,SAAKwC,EAEnDoH,gBAAkBC,GAAW,GAAG5G,EAAQjD,OAAO6J,EAAO,MAAMA,EAAO,MAAMA,EAAO,QACpF5C,KAAK6C,oBAAoB7C,KAAK8C,WAAWnH,KAAKqE,OAC9CA,KAAKnD,KAA+B,QAAvBzB,EAAKY,EAAQa,YAAyBtB,IAAPH,EAAmBA,GAAK,QAAqBW,EAAgBC,IACpGc,MAAMD,GAASA,EAAKE,KAAKf,EAAQjD,KAAK+D,MAAK,IAAMD,MACtDmD,KAAKlE,KAAOE,EAAQF,IACxB,CAEA,UAAAgH,CAAWpB,EAAMsB,GACb3H,EAAM,eAAgB,CAACqG,EAAKuB,UAAU,GAAIvB,EAAKuB,UAAU,GAAIvB,EAAKuB,UAAU,KAC5E,MAAMrJ,EAAQ8H,EAAKoC,WACnB9D,KAAKnD,KACAC,MAAME,GAAMA,EAAEC,KAAK,kGAAmG,CACvHmG,MAAO1B,EAAKuB,UAAU,GACtBI,KAAM3B,EAAKuB,UAAU,GACrBK,MAAO,GAAK5B,EAAKuB,UAAU,IAAM,EAAIvB,EAAKuB,UAAU,OAEnDnG,MAAMI,IACP,KAAIA,GAAKA,EAAE,IACHA,EAAE,GAAGM,IAAI,aAAcuG,YAO/B,MAAM,IAAItG,MAAM,eAAeiE,EAAKuB,aARpC,CAEQ,MAAMe,EAAO,IAAIC,KAAK,CAAC/G,EAAE,GAAGM,IAAI,IAAK,CAAE3B,KAAMmE,KAAKlE,OAC5CoI,EAAWC,IAAIC,gBAAgBJ,GACrCpK,EAAMyK,IAAMH,CAGpB,CACgD,IAE/C1E,OAAOC,IACRpE,EAAMoE,GACNiC,EAAK4C,SAAS,IAAUC,MAAM,GAEtC,CACA,eAAAX,GACI,OAAO5D,KAAKnD,KAAKC,MAAME,GAAMA,EAAE0C,SACnC,E","sources":["webpack://ol-mbtiles/./examples/code/osm-vector-tiles.ts","webpack://ol-mbtiles/./examples/style.ts","webpack://ol-mbtiles/./dist/index.js"],"sourcesContent":["import Map from 'ol/Map.js';\nimport TileLayer from 'ol/layer/Tile.js';\nimport View from 'ol/View.js';\nimport VectorTileLayer from 'ol/layer/VectorTile';\nimport TileDebug from 'ol/source/TileDebug';\nimport { fromLonLat } from 'ol/proj';\nimport Style from 'ol/style/Style';\nimport { FeatureLike } from 'ol/Feature';\n\nimport { importMBTiles, MBTilesVectorSource } from 'ol-mbtiles';\nimport { waterStyle, roadStyle, buildingStyle, boundaryStyle, placeStyle } from '../style';\n\n// MBTiles from\n// https://data.maptiler.com/downloads/dataset/osm/europe/\n// 34.4 GB original file\n// down to 19.2GB after vacuum (MapTiler, wtf?)\n\nexport default async function () {\n  return new Map({\n    target: 'map',\n    layers: [\n      new TileLayer({\n        source: new TileDebug()\n      }),\n      new VectorTileLayer({\n        source: new MBTilesVectorSource(await importMBTiles({\n          url: 'https://velivole.b-cdn.net/maptiler-osm-2017-07-03-v3.6.1-europe.mbtiles',\n          layers: ['transportation', 'water', 'waterway', 'landuse', 'place', 'boundary'],\n          // All properties from the MBTiles data can be overridden\n          attributions: ['MapTiler', 'OSM', 'https://data.maptiler.com/downloads/dataset/osm/europe/'],\n        })),\n        style: function (feature: FeatureLike): Style {\n          switch (feature.get('layer')) {\n            case 'water':\n            case 'waterway':\n              return waterStyle;\n            case 'transportation':\n              return roadStyle(feature);\n            case 'landuse':\n              return buildingStyle;\n            case 'boundary':\n              return boundaryStyle;\n            case 'place':\n              return placeStyle(feature);\n            default:\n              return null as unknown as Style;\n          }\n        }\n      })\n    ],\n    view: new View({\n      center: fromLonLat([12, 50]),\n      zoom: 6\n    }),\n  });\n}","import { FeatureLike } from 'ol/Feature';\nimport { Style, Text, Fill, Stroke, Circle } from 'ol/style';\n\nexport function styleTown(size: number, feature: FeatureLike): Style {\n  let width: number;\n  let font: string;\n  switch (size) {\n    case 0:\n      width = 6;\n      font = '2em';\n      break;\n    case 1:\n      width = 5;\n      font = '1.2em';\n      break;\n    case 2:\n      width = 3;\n      font = '0.8em';\n      break;\n    default:\n      width = 1;\n      font = '0.5em';\n      break;\n  }\n  font += ' helvetica, sans-serif';\n  const color1 = '#00007f';\n  const color2 = '#ffffff';\n\n  const style = new Style({\n    image: new Circle({\n      fill: new Fill({\n        color: color1,\n      }),\n      radius: width,\n      stroke: new Stroke({\n        color: color1,\n        width: width,\n      }),\n    }),\n    text: new Text({\n      font: font,\n      text: feature.get('n'),\n      fill: new Fill({\n        color: color2\n      }),\n      stroke: new Stroke({\n        color: color1,\n        width: 2\n      })\n    })\n  });\n  return style;\n}\n\nexport const styleBorder = new Style({\n  stroke: new Stroke({\n    color: 'blue',\n    width: 2\n  })\n});\n\n\n// Styles inspired from https://openlayers.org/en/latest/examples/osm-vector-tiles.html\nconst roadStyleCache: Record<string, Style> = {};\nconst roadColor: Record<string, string> = {\n  'motorway': '#776',\n  'trunk': '#ccb',\n  'highway': '#f39',\n};\nexport const buildingStyle = new Style({\n  fill: new Fill({\n    color: '#666'\n  }),\n  stroke: new Stroke({\n    color: '#444',\n    width: 1,\n  }),\n});\nexport const waterStyle = new Style({\n  fill: new Fill({\n    color: '#9db9e8',\n  }),\n});\nexport const boundaryStyle = new Style({\n  stroke: new Stroke({\n    color: '#8B008B',\n    width: 2,\n  }),\n});\nexport const roadStyle = function (feature: FeatureLike) {\n  const kind = feature.get('class');\n  const railway = feature.get('railway');\n  const sort_key = feature.get('sort_key');\n  const styleKey = kind + '/' + railway + '/' + sort_key;\n  let style = roadStyleCache[styleKey];\n  if (!style) {\n    let color, width;\n    if (railway) {\n      color = '#7de';\n      width = 1;\n    } else {\n      color = roadColor[kind];\n      width = kind == 'highway' ? 1.5 : 1;\n    }\n    style = new Style({\n      stroke: new Stroke({\n        color: color,\n        width: width,\n      }),\n      zIndex: sort_key,\n    });\n    roadStyleCache[styleKey] = style;\n  }\n  return style;\n};\nconst placeBase = new Style({\n  image: new Circle({\n    radius: 5,\n    fill: new Fill({\n      color: '#000080'\n    })\n  })\n});\nconst textStroke = new Stroke({\n  color: 'white',\n  width: 2\n});\nexport const placeStyle = function (feature: FeatureLike): Style {\n  if (feature.get('class') == 'country')\n    return null as unknown as Style;\n  if (feature.get('name')) {\n    const style = placeBase.clone();\n    style.setText(new Text({\n      text: feature.get('name'),\n      offsetY: -5,\n      font: 'bold 16px sans-serif',\n      stroke: textStroke\n    }));\n    return style;\n  }\n  return null as unknown as Style;\n};","import { createSQLiteHTTPPool } from 'sqlite-wasm-http';\nimport { get, transformExtent } from 'ol/proj.js';\nimport { getWidth } from 'ol/extent.js';\nimport TileGrid from 'ol/tilegrid/TileGrid.js';\nimport VectorTileSource from 'ol/source/VectorTile.js';\nimport Protobuf from 'pbf';\nimport { VectorTile } from '@mapbox/vector-tile';\nimport pako from 'pako';\nimport FeatureFormat from 'ol/format/Feature.js';\nimport Projection from 'ol/proj/Projection.js';\nimport RenderFeature from 'ol/render/Feature.js';\nimport ImageTileSource from 'ol/source/TileImage.js';\nimport TileState from 'ol/TileState.js';\n\nvar _a;\nconst debugEnabled = (typeof OL_MBTILES_DEBUG !== 'undefined' && OL_MBTILES_DEBUG) ||\n    (typeof process !== 'undefined' && typeof ((_a = process === null || process === undefined ? undefined : process.env) === null || _a === undefined ? undefined : _a.OL_MBTILES_DEBUG) !== 'undefined' && process.env.OL_MBTILES_DEBUG);\nconst debug = debugEnabled ? console.debug.bind(console) : () => undefined;\n\nconst formats = {\n    'jpg': { type: 'raster', mime: 'image/jpeg' },\n    'png': { type: 'raster', mime: 'image/png' },\n    'webp': { type: 'raster', mime: 'image/webp' },\n    'pbf': { type: 'vector' },\n    'mvt': { type: 'vector' },\n};\nfunction httpPoolOptions(options) {\n    var _a, _b, _c;\n    return {\n        workers: (_a = options === null || options === undefined ? undefined : options.sqlWorkers) !== null && _a !== undefined ? _a : 4,\n        httpOptions: {\n            backendType: options === null || options === undefined ? undefined : options.backendType,\n            maxPageSize: (_b = options === null || options === undefined ? undefined : options.maxSqlPageSize) !== null && _b !== undefined ? _b : 4096,\n            cacheSize: (_c = options === null || options === undefined ? undefined : options.sqlCacheSize) !== null && _c !== undefined ? _c : 4096\n        },\n    };\n}\n/**\n * Automatically import MBTiles metadata and return an options object\n * compatible with the source constructors.\n *\n * @param {(MBTilesRasterOptions | MBTilesVectorOptions) & SQLOptions} opt Any MBTiles{Raster|Vector}Source options to be overridden\n * @param {string} opt.url URL of the remote tileset\n * @returns {(MBTilesRasterOptions | MBTilesVectorOptions)}\n */\nfunction importMBTiles(opt) {\n    const pool = createSQLiteHTTPPool(httpPoolOptions(opt));\n    return pool\n        .then((pool) => pool.open(opt.url).then(() => pool))\n        .then((p) => p.exec('SELECT name,value FROM metadata'))\n        .then((r) => {\n        if (r && r.length) {\n            // Transform an array of form [ ['name', 'value' ], ... ] to object\n            const data = r.reduce((a, x) => {\n                a[x.row[0]] = x.row[1];\n                return a;\n            }, {});\n            debug('Loaded metadata', data);\n            return data;\n        }\n        throw new Error('Could not load metadata');\n    })\n        .then((md) => {\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j;\n        const opts = Object.assign({}, opt);\n        const format = (_b = (_a = md['format']) === null || _a === undefined ? undefined : _a.toLowerCase) === null || _b === undefined ? undefined : _b.call(_a);\n        if (!formats[format])\n            console.warn('Unknown tile format', format);\n        // Sometimes, I wonder if Mapbox doesn't hold a patent or some\n        // other kind of investment related to everyone using 3857\n        opts.projection = (_c = opt.projection) !== null && _c !== undefined ? _c : 'EPSG:3857';\n        opts.attributions = ((_d = md.attribution) !== null && _d !== undefined ? _d : md.description);\n        opts.maxZoom = (_e = opt.maxZoom) !== null && _e !== undefined ? _e : +md['maxzoom'];\n        opts.minZoom = (_f = opt.minZoom) !== null && _f !== undefined ? _f : +md['minzoom'];\n        const projExtent = (_h = (_g = get(opts.projection)) === null || _g === undefined ? undefined : _g.getExtent) === null || _h === undefined ? undefined : _h.call(_g);\n        const bounds = md['bounds'];\n        const extent = bounds ?\n            transformExtent(bounds.split(',').map((r) => +r), 'EPSG:4326', opts.projection) :\n            projExtent;\n        if (formats[format].type === 'raster') {\n            if (opts.maxZoom === undefined || opts.minZoom === undefined || projExtent === undefined)\n                throw new Error('Cannot determine tilegrid, need minZoom, maxZoom');\n            const baseResolution = getWidth(projExtent) / 256;\n            const resolutions = [baseResolution];\n            for (let z = 1; z <= opts.maxZoom; z++)\n                resolutions.push(resolutions[resolutions.length - 1] / 2);\n            const mime = (_j = formats[format].mime) !== null && _j !== undefined ? _j : format;\n            opts.mime = mime;\n            opts.tileGrid = new TileGrid({\n                origin: [projExtent[0], projExtent[2]],\n                extent,\n                minZoom: opts.minZoom,\n                resolutions\n            });\n        }\n        else {\n            const vectorOpts = opts;\n            // Alas VectorTileSource in OpenLayers does not support\n            // constraining the extent while keeping the origin\n            vectorOpts.extent = projExtent;\n        }\n        opts.pool = pool;\n        opts.url = opt.url;\n        return opts;\n    })\n        .catch((e) => pool.then((p) => p.close()).then(() => Promise.reject(e)));\n}\n\nclass MBTilesFormat extends FeatureFormat {\n    constructor(options) {\n        var _a, _b, _c;\n        super();\n        options = options ? options : {};\n        this.dataProjection = new Projection({\n            code: '',\n            units: 'tile-pixels',\n        });\n        this.featureClass_ = options.featureClass ? options.featureClass : RenderFeature;\n        this.geometryName_ = (_a = options.geometryName) !== null && _a !== undefined ? _a : 'Geometry';\n        this.layers_ = (_b = options.layers) !== null && _b !== undefined ? _b : null;\n        this.idProperty_ = options.idProperty;\n        this.extent = (_c = options.extent) !== null && _c !== undefined ? _c : 4096;\n        /*\n         * As this is the very first time MBTiles will be distributed by HTTP\n         * there is still no official MIME type\n         */\n        this.supportedMediaTypes = [\n            'application/vnd-mbtiles'\n        ];\n    }\n    readFeature(source, options) {\n        const properties = source.properties;\n        let id;\n        if (!this.idProperty_) {\n            id = source.id;\n        }\n        else {\n            id = properties[this.idProperty_];\n            delete properties[this.idProperty_];\n        }\n        const points = source.loadGeometry();\n        const flatCoordinates = [];\n        const ends = [];\n        const type = MBTilesFormat.MBTypes[points.length > 1 ? 'multi' : 'mono'][source.type];\n        if (type === 'Unknown')\n            return null;\n        for (let i = 0; i < points.length; i++) {\n            if (points[i].length == 0)\n                continue;\n            for (let j = 0; j < points[i].length; j++) {\n                flatCoordinates.push(points[i][j].x, points[i][j].y);\n            }\n            ends.push(flatCoordinates.length);\n        }\n        const feature = new this.featureClass_(type, flatCoordinates, ends, 2, properties, id);\n        if ((options === null || options === undefined ? undefined : options.dataProjection) && 'transform' in feature)\n            feature.transform(options === null || options === undefined ? undefined : options.dataProjection);\n        return feature;\n    }\n    readFeatures(source, options) {\n        const layers = this.layers_;\n        const features = [];\n        const tile = new VectorTile(new Protobuf(pako.ungzip(source)));\n        options = this.adaptOptions(options);\n        const dataProjection = get(options === null || options === undefined ? undefined : options.dataProjection);\n        const extent = options === null || options === undefined ? undefined : options.extent;\n        if (!dataProjection || !options || !extent)\n            throw new Error('Cannot determine the projection/extent');\n        dataProjection.setWorldExtent(extent);\n        dataProjection.setExtent([0, 0, this.extent, this.extent]);\n        options.dataProjection = dataProjection;\n        for (const layerName of Object.keys(tile.layers)) {\n            if (layers && !layers.includes(layerName)) {\n                continue;\n            }\n            const l = tile.layers[layerName];\n            for (let idx = 0; idx < l.length; idx++) {\n                const vectorFeature = l.feature(idx);\n                const feature = this.readFeature(vectorFeature, options);\n                feature.getProperties().layer = layerName;\n                features.push(feature);\n            }\n        }\n        return features;\n    }\n    readProjection() {\n        return this.dataProjection;\n    }\n}\nMBTilesFormat.MBTypes = {\n    mono: ['Unknown', 'Point', 'LineString', 'Polygon'],\n    multi: ['Unknown', 'MultiPoint', 'MultiLineString', 'Polygon']\n};\n\n/**\n * A tile source in a remote .mbtiles file accessible by HTTP\n *\n * WARNING\n * If your application continuously creates and removes MBTilesSource\n * objects, special care must be taken to properly dispose of them.\n * An MBTilesSource creates a thread pool that the JS engine is unable to\n * automatically garbage-collect unless the dispose() method\n * is invoked.\n * If you need to dispose a map that can potentially contain\n * MBTilesSource objects, check loadExample() in\n * https://github.com/mmomtchev/ol-mbtiles/blob/main/examples/index.ts#L15\n */\nclass MBTilesVectorSource extends VectorTileSource {\n    /**\n     * @param {MBTilesVectorOptions} options options\n     */\n    constructor(options) {\n        var _a;\n        if (options.url === undefined && options.pool === undefined)\n            throw new Error('Must specify url');\n        super(Object.assign(Object.assign({}, options), { url: undefined, format: new MBTilesFormat({\n                layers: options.layers\n            }), \n            // This is required to prevent Openlayers' cache from thinking that all tiles share the same URL\n            tileUrlFunction: (coords) => `${options.url}#${coords[0]}:${coords[1]}:${coords[2]}` }));\n        this.setTileLoadFunction(this.tileLoader.bind(this));\n        this.pool = (_a = options.pool) !== null && _a !== undefined ? _a : createSQLiteHTTPPool(httpPoolOptions(options))\n            .then((pool) => pool.open(options.url).then(() => pool));\n    }\n    tileLoader(_tile, _url) {\n        const tile = _tile;\n        debug('loading tile', [tile.tileCoord[0], tile.tileCoord[1], tile.tileCoord[2]]);\n        tile.setLoader((extent, resolution, projection) => {\n            this.pool\n                .then((p) => p.exec('SELECT tile_data FROM tiles WHERE zoom_level = $zoom AND tile_column = $col AND tile_row = $row', {\n                $zoom: tile.tileCoord[0],\n                $col: tile.tileCoord[1],\n                $row: (1 << tile.tileCoord[0]) - 1 - tile.tileCoord[2]\n            }))\n                .then((r) => {\n                if (r && r[0] && r[0].row[0]) {\n                    const format = tile.getFormat();\n                    const features = format.readFeatures(r[0].row[0], {\n                        extent,\n                        featureProjection: projection\n                    });\n                    tile.setFeatures(features);\n                    tile.onLoad(features, projection);\n                    return;\n                }\n                throw new Error(`No data for ${tile.tileCoord}`);\n            })\n                .catch((e) => {\n                debug(e);\n                tile.onError();\n            });\n        });\n    }\n    disposeInternal() {\n        return this.pool.then((p) => p.close());\n    }\n}\n\n/**\n * A tile source in a remote .mbtiles file accessible by HTTP\n *\n * WARNING\n * If your application continuously creates and removes MBTilesSource\n * objects, special care must be taken to properly dispose of them.\n * An MBTilesSource creates a thread pool that the JS engine is unable to\n * automatically garbage-collect unless the dispose() method\n * is invoked.\n * If you need to dispose a map that can potentially contain\n * MBTilesSource objects, check loadExample() in\n * https://github.com/mmomtchev/ol-mbtiles/blob/main/examples/index.ts#L15\n */\nclass MBTilesRasterSource extends ImageTileSource {\n    /**\n     * @param {MBTilesRasterOptions} options options\n     */\n    constructor(options) {\n        var _a;\n        if (options.url === undefined && options.pool === undefined)\n            throw new Error('Must specify url');\n        super(Object.assign(Object.assign({}, options), { url: undefined, \n            // This is required to prevent Openlayers' cache from thinking that all tiles share the same URL\n            tileUrlFunction: (coords) => `${options.url}#${coords[0]}:${coords[1]}:${coords[2]}` }));\n        this.setTileLoadFunction(this.tileLoader.bind(this));\n        this.pool = (_a = options.pool) !== null && _a !== undefined ? _a : createSQLiteHTTPPool(httpPoolOptions(options))\n            .then((pool) => pool.open(options.url).then(() => pool));\n        this.mime = options.mime;\n    }\n    // TODO fix the tile type in Openlayers\n    tileLoader(tile, _url) {\n        debug('loading tile', [tile.tileCoord[0], tile.tileCoord[1], tile.tileCoord[2]]);\n        const image = tile.getImage();\n        this.pool\n            .then((p) => p.exec('SELECT tile_data FROM tiles WHERE zoom_level = $zoom AND tile_column = $col AND tile_row = $row', {\n            $zoom: tile.tileCoord[0],\n            $col: tile.tileCoord[1],\n            $row: (1 << tile.tileCoord[0]) - 1 - tile.tileCoord[2]\n        }))\n            .then((r) => {\n            if (r && r[0]) {\n                if (r[0].row[0] instanceof Uint8Array) {\n                    const blob = new Blob([r[0].row[0]], { type: this.mime });\n                    const imageUrl = URL.createObjectURL(blob);\n                    image.src = imageUrl;\n                    return;\n                }\n            }\n            throw new Error(`No data for ${tile.tileCoord}`);\n        })\n            .catch((e) => {\n            debug(e);\n            tile.setState(TileState.ERROR);\n        });\n    }\n    disposeInternal() {\n        return this.pool.then((p) => p.close());\n    }\n}\n\nexport { MBTilesFormat, MBTilesRasterSource, MBTilesVectorSource, importMBTiles };\n//# sourceMappingURL=index.js.map\n"],"names":["target","layers","source","url","attributions","style","feature","get","view","center","zoom","styleTown","size","width","font","color1","image","fill","color","radius","stroke","text","styleBorder","roadStyleCache","roadColor","buildingStyle","waterStyle","boundaryStyle","roadStyle","kind","railway","sort_key","styleKey","zIndex","placeBase","textStroke","placeStyle","clone","setText","offsetY","_a","debug","process","undefined","env","OL_MBTILES_DEBUG","console","bind","formats","type","mime","httpPoolOptions","options","_b","_c","workers","sqlWorkers","httpOptions","backendType","maxPageSize","maxSqlPageSize","cacheSize","sqlCacheSize","importMBTiles","opt","pool","then","open","p","exec","r","length","data","reduce","a","x","row","Error","md","_d","_e","_f","_g","_h","_j","opts","Object","assign","format","toLowerCase","call","warn","projection","attribution","description","maxZoom","minZoom","projExtent","getExtent","bounds","extent","split","map","resolutions","z","push","tileGrid","origin","catch","e","close","Promise","reject","MBTilesFormat","constructor","super","this","dataProjection","code","units","featureClass_","featureClass","geometryName_","geometryName","layers_","idProperty_","idProperty","supportedMediaTypes","readFeature","properties","id","points","loadGeometry","flatCoordinates","ends","MBTypes","i","j","y","transform","readFeatures","features","tile","VectorTile","adaptOptions","setWorldExtent","setExtent","layerName","keys","includes","l","idx","vectorFeature","getProperties","layer","readProjection","mono","multi","MBTilesVectorSource","tileUrlFunction","coords","setTileLoadFunction","tileLoader","_tile","_url","tileCoord","setLoader","resolution","$zoom","$col","$row","getFormat","featureProjection","setFeatures","onLoad","onError","disposeInternal","MBTilesRasterSource","getImage","Uint8Array","blob","Blob","imageUrl","URL","createObjectURL","src","setState","ERROR"],"sourceRoot":""}