"use strict";(self.webpackChunkol_mbtiles=self.webpackChunkol_mbtiles||[]).push([[826],{7826:(e,o,t)=>{t.r(o),t.d(o,{default:()=>w});var r,n=t(8859),i=t(2479),l=t(8266),s=t(9090),a=t(6263),d=t(8661),u=t(8641),c=t(1850),p=t(8738);const m=null===(r=(0,d.U2)("EPSG:3857"))||void 0===r?void 0:r.getExtent(),h=(0,u.dz)(m)/256;function v(e){const o=[h];for(let t=1;t<=e;t++)o.push(o[o.length-1]/2);return o}function w(){return new n.Z({target:"map",layers:[new i.Z({zIndex:20,source:new a.Z}),new i.Z({zIndex:0,source:new l.Z}),new i.Z({zIndex:10,opacity:.5,source:new c.Yr({url:"https://velivole.b-cdn.net/tiles-RGR92UTM40S.mbtiles",attributions:["IGN / Mapotempo","BD Ortho 5m","https://www.data.gouv.fr/en/datasets/pyramide-de-tuiles-depuis-la-bd-ortho-r/"],tileGrid:new p.Z({origin:[m[0],m[2]],extent:[6141145.607336855,-2443028.8860581857,6216858.872510456,-2366876.107971946],minZoom:9,resolutions:v(16)})})})],view:new s.ZP({center:(0,d.mi)([55.47437,-21.08468]),zoom:9})})}},1850:(e,o,t)=>{t.d(o,{H5:()=>P,Yr:()=>j,ri:()=>b});var r,n=t(7273),i=t(8661),l=t(8641),s=t(8738),a=t(7205),d=t(3614),u=t(8929),c=t(7885),p=t(8087),m=t(9619),h=t(7571),v=t(4187),w=t(928),g=t(7195);const f="undefined"!=typeof process&&void 0!==(null===(r=null===process||void 0===process?void 0:process.env)||void 0===r?void 0:r.OL_MBTILES_DEBUG)&&process.env.OL_MBTILES_DEBUG?console.debug.bind(console):()=>{},y={jpg:{type:"raster",mime:"image/jpeg"},png:{type:"raster",mime:"image/png"},webp:{type:"raster",mime:"image/webp"},pbf:{type:"vector"},mvt:{type:"vector"}};function x(e){var o,t,r;return{workers:null!==(o=null==e?void 0:e.sqlWorkers)&&void 0!==o?o:4,httpOptions:{backendType:null==e?void 0:e.backendType,maxPageSize:null!==(t=null==e?void 0:e.maxSqlPageSize)&&void 0!==t?t:4096,cacheSize:null!==(r=null==e?void 0:e.sqlCacheSize)&&void 0!==r?r:4096}}}function b(e){const o=(0,n.he)(x(e));return o.then((o=>o.open(e.url).then((()=>o)))).then((e=>e.exec("SELECT name,value FROM metadata"))).then((e=>{if(e&&e.length){const o=e.reduce(((e,o)=>(e[o.row[0]]=o.row[1],e)),{});return f("Loaded metadata",o),o}throw new Error("Could not load metadata")})).then((t=>{var r,n,a,d,u,c,p,m,h;const v=Object.assign({},e),w=null===(n=null===(r=t.format)||void 0===r?void 0:r.toLowerCase)||void 0===n?void 0:n.call(r);y[w]||console.warn("Unknown tile format",w),v.projection=null!==(a=e.projection)&&void 0!==a?a:"EPSG:3857",v.attributions=null!==(d=t.attribution)&&void 0!==d?d:t.description,v.maxZoom=null!==(u=e.maxZoom)&&void 0!==u?u:+t.maxzoom,v.minZoom=null!==(c=e.minZoom)&&void 0!==c?c:+t.minzoom;const g=null===(m=null===(p=(0,i.U2)(v.projection))||void 0===p?void 0:p.getExtent)||void 0===m?void 0:m.call(p),f=t.bounds,x=f?(0,i.$A)(f.split(",").map((e=>+e)),"EPSG:4326",v.projection):g;if("raster"===y[w].type){if(void 0===v.maxZoom||void 0===v.minZoom||void 0===g)throw new Error("Cannot determine tilegrid, need minZoom, maxZoom");const e=[(0,l.dz)(g)/256];for(let o=1;o<=v.maxZoom;o++)e.push(e[e.length-1]/2);const o=null!==(h=y[w].mime)&&void 0!==h?h:w;v.mime=o,v.tileGrid=new s.Z({origin:[g[0],g[2]],extent:x,minZoom:v.minZoom,resolutions:e})}else v.extent=g;return v.pool=o,v.url=e.url,v})).catch((e=>o.then((e=>e.close())).then((()=>Promise.reject(e)))))}const Z=v.q4.split(".").map((e=>+e)),E=Z[0]>8||8===Z[0]&&Z[1]>=2;class C extends p.ZP{constructor(e){var o,t,r;super(),e=e||{},this.dataProjection=new m.Z({code:"",units:"tile-pixels"}),this.featureClass_=e.featureClass?e.featureClass:h.ZP,this.geometryName_=null!==(o=e.geometryName)&&void 0!==o?o:"Geometry",this.layers_=null!==(t=e.layers)&&void 0!==t?t:null,this.idProperty_=e.idProperty,this.extent=null!==(r=e.extent)&&void 0!==r?r:4096,this.supportedMediaTypes=["application/vnd-mbtiles"]}readFeature(e,o){const t=e.properties;let r;this.idProperty_?(r=t[this.idProperty_],delete t[this.idProperty_]):r=e.id;const n=e.loadGeometry(),i=[],l=[],s=C.MBTypes[n.length>1?"multi":"mono"][e.type];if("Unknown"===s)return null;for(let e=0;e<n.length;e++)if(0!=n[e].length){for(let o=0;o<n[e].length;o++)i.push(n[e][o].x,n[e][o].y);l.push(i.length)}const a=function(e,o,t,r,n,i){return E?new e(o,t,r,2,n,i):new e(o,t,r,n,i)}(this.featureClass_,s,i,l,t,r);return a.transform(null==o?void 0:o.dataProjection),a}readFeatures(e,o){const t=this.layers_,r=[],n=new u.VectorTile(new d(c.ZP.ungzip(e)));o=this.adaptOptions(o);const l=(0,i.U2)(null==o?void 0:o.dataProjection),s=null==o?void 0:o.extent;if(!l||!o||!s)throw new Error("Cannot determine the projection/extent");l.setWorldExtent(s),l.setExtent([0,0,this.extent,this.extent]),o.dataProjection=l;for(const e of Object.keys(n.layers)){if(t&&!t.includes(e))continue;const i=n.layers[e];for(let t=0;t<i.length;t++){const n=i.feature(t),l=this.readFeature(n,o);l.getProperties().layer=e,r.push(l)}}return r}readProjection(){return this.dataProjection}}C.MBTypes={mono:["Unknown","Point","LineString","Polygon"],multi:["Unknown","MultiPoint","MultiLineString","Polygon"]};class P extends a.Z{constructor(e){var o;if(void 0===e.url&&void 0===e.pool)throw new Error("Must specify url");super(Object.assign(Object.assign({},e),{url:void 0,format:new C({layers:e.layers}),tileUrlFunction:o=>`${e.url}#${o[0]}:${o[1]}:${o[2]}`})),this.setTileLoadFunction(this.tileLoader.bind(this)),this.pool=null!==(o=e.pool)&&void 0!==o?o:(0,n.he)(x(e)).then((o=>o.open(e.url).then((()=>o))))}tileLoader(e,o){const t=e;f("loading tile",[t.tileCoord[0],t.tileCoord[1],t.tileCoord[2]]),t.setLoader(((e,o,r)=>{this.pool.then((e=>e.exec("SELECT tile_data FROM tiles WHERE zoom_level = $zoom AND tile_column = $col AND tile_row = $row",{$zoom:t.tileCoord[0],$col:t.tileCoord[1],$row:(1<<t.tileCoord[0])-1-t.tileCoord[2]}))).then((o=>{if(o&&o[0]&&o[0].row[0]){const n=t.getFormat().readFeatures(o[0].row[0],{extent:e,featureProjection:r});return t.setFeatures(n),void t.onLoad(n,r)}throw new Error(`No data for ${t.tileCoord}`)})).catch((e=>{f(e),t.onError()}))}))}disposeInternal(){return this.pool.then((e=>e.close()))}}class j extends w.Z{constructor(e){var o;if(void 0===e.url&&void 0===e.pool)throw new Error("Must specify url");super(Object.assign(Object.assign({},e),{url:void 0,tileUrlFunction:o=>`${e.url}#${o[0]}:${o[1]}:${o[2]}`})),this.setTileLoadFunction(this.tileLoader.bind(this)),this.pool=null!==(o=e.pool)&&void 0!==o?o:(0,n.he)(x(e)).then((o=>o.open(e.url).then((()=>o)))),this.mime=e.mime}tileLoader(e,o){f("loading tile",[e.tileCoord[0],e.tileCoord[1],e.tileCoord[2]]);const t=e.getImage();this.pool.then((o=>o.exec("SELECT tile_data FROM tiles WHERE zoom_level = $zoom AND tile_column = $col AND tile_row = $row",{$zoom:e.tileCoord[0],$col:e.tileCoord[1],$row:(1<<e.tileCoord[0])-1-e.tileCoord[2]}))).then((o=>{if(!(o&&o[0]&&o[0].row[0]instanceof Uint8Array))throw new Error(`No data for ${e.tileCoord}`);{const e=new Blob([o[0].row[0]],{type:this.mime}),r=URL.createObjectURL(e);t.src=r}})).catch((o=>{f(o),e.setState(g.Z.ERROR)}))}disposeInternal(){return this.pool.then((e=>e.close()))}}},8266:(e,o,t)=>{t.d(o,{Z:()=>i});var r=t(4680);class n extends r.Z{constructor(e){let o;o=void 0!==(e=e||{}).attributions?e.attributions:['&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.'];const t=void 0!==e.crossOrigin?e.crossOrigin:"anonymous",r=void 0!==e.url?e.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:o,attributionsCollapsible:!1,cacheSize:e.cacheSize,crossOrigin:t,interpolate:e.interpolate,maxZoom:void 0!==e.maxZoom?e.maxZoom:19,opaque:void 0===e.opaque||e.opaque,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:r,wrapX:e.wrapX,zDirection:e.zDirection})}}const i=n}}]);
//# sourceMappingURL=826.bundle.js.map