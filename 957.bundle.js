"use strict";(self.webpackChunkol_mbtiles=self.webpackChunkol_mbtiles||[]).push([[957],{957:(t,e,i)=>{i.d(e,{A:()=>ft});var s=i(4015);const n={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},o=[n.FILL],r=[n.STROKE],l=[n.BEGIN_PATH],a=[n.CLOSE_PATH],h=n;var c=i(1580);const d=class{drawCustom(t,e,i,s,n){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,i){}drawFeature(t,e,i){}drawGeometryCollection(t,e,i){}drawLineString(t,e,i){}drawMultiLineString(t,e,i){}drawMultiPoint(t,e,i){}drawMultiPolygon(t,e,i){}drawPoint(t,e,i){}drawPolygon(t,e,i){}drawText(t,e,i){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}};var g=i(7295),u=i(915),_=i(8774),f=i(6514),x=i(6361);const S=class extends d{constructor(t,e,i,s){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=s,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return 1==e?t:t.map((function(t){return t*e}))}appendFlatPointCoordinates(t,e){const i=this.getBufferedMaxExtent(),s=this.tmpCoordinate_,n=this.coordinates;let o=n.length;for(let r=0,l=t.length;r<l;r+=e)s[0]=t[r],s[1]=t[r+1],(0,u.Ym)(i,s)&&(n[o++]=s[0],n[o++]=s[1]);return o}appendFlatLineCoordinates(t,e,i,s,n,o){const r=this.coordinates;let l=r.length;const a=this.getBufferedMaxExtent();o&&(e+=s);let h=t[e],d=t[e+1];const g=this.tmpCoordinate_;let _,f,x,S=!0;for(_=e+s;_<i;_+=s)g[0]=t[_],g[1]=t[_+1],x=(0,u.vz)(a,g),x!==f?(S&&(r[l++]=h,r[l++]=d,S=!1),r[l++]=g[0],r[l++]=g[1]):x===c.A.INTERSECTING?(r[l++]=g[0],r[l++]=g[1],S=!1):S=!0,h=g[0],d=g[1],f=x;return(n&&S||_===e+s)&&(r[l++]=h,r[l++]=d),l}drawCustomCoordinates_(t,e,i,s,n){for(let o=0,r=i.length;o<r;++o){const r=i[o],l=this.appendFlatLineCoordinates(t,e,r,s,!1,!1);n.push(l),e=r}return e}drawCustom(t,e,i,s,n){this.beginGeometry(t,e,n);const o=t.getType(),r=t.getStride(),l=this.coordinates.length;let a,c,d,g,u;switch(o){case"MultiPolygon":a=t.getOrientedFlatCoordinates(),g=[];const e=t.getEndss();u=0;for(let t=0,i=e.length;t<i;++t){const i=[];u=this.drawCustomCoordinates_(a,u,e[t],r,i),g.push(i)}this.instructions.push([h.CUSTOM,l,g,t,i,x.Dz,n]),this.hitDetectionInstructions.push([h.CUSTOM,l,g,t,s||i,x.Dz,n]);break;case"Polygon":case"MultiLineString":d=[],a="Polygon"==o?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),u=this.drawCustomCoordinates_(a,0,t.getEnds(),r,d),this.instructions.push([h.CUSTOM,l,d,t,i,x.cD,n]),this.hitDetectionInstructions.push([h.CUSTOM,l,d,t,s||i,x.cD,n]);break;case"LineString":case"Circle":a=t.getFlatCoordinates(),c=this.appendFlatLineCoordinates(a,0,a.length,r,!1,!1),this.instructions.push([h.CUSTOM,l,c,t,i,x.n2,n]),this.hitDetectionInstructions.push([h.CUSTOM,l,c,t,s||i,x.n2,n]);break;case"MultiPoint":a=t.getFlatCoordinates(),c=this.appendFlatPointCoordinates(a,r),c>l&&(this.instructions.push([h.CUSTOM,l,c,t,i,x.n2,n]),this.hitDetectionInstructions.push([h.CUSTOM,l,c,t,s||i,x.n2,n]));break;case"Point":a=t.getFlatCoordinates(),this.coordinates.push(a[0],a[1]),c=this.coordinates.length,this.instructions.push([h.CUSTOM,l,c,t,i,void 0,n]),this.hitDetectionInstructions.push([h.CUSTOM,l,c,t,s||i,void 0,n])}this.endGeometry(e)}beginGeometry(t,e,i){this.beginGeometryInstruction1_=[h.BEGIN_GEOMETRY,e,0,t,i],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[h.BEGIN_GEOMETRY,e,0,t,i],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;let e;t.reverse();const i=t.length;let s,n,o=-1;for(e=0;e<i;++e)s=t[e],n=s[0],n==h.END_GEOMETRY?o=e:n==h.BEGIN_GEOMETRY&&(s[2]=e,(0,f.gI)(this.hitDetectionInstructions,o,e),o=-1)}setFillStrokeStyle(t,e){const i=this.state;if(t){const e=t.getColor();i.fillPatternScale=e&&"object"==typeof e&&"src"in e?this.pixelRatio:1,i.fillStyle=(0,g.F)(e||_.qY)}else i.fillStyle=void 0;if(e){const t=e.getColor();i.strokeStyle=(0,g.F)(t||_.NT);const s=e.getLineCap();i.lineCap=void 0!==s?s:_._m;const n=e.getLineDash();i.lineDash=n?n.slice():_.Oq;const o=e.getLineDashOffset();i.lineDashOffset=o||_.vk;const r=e.getLineJoin();i.lineJoin=void 0!==r?r:_._K;const l=e.getWidth();i.lineWidth=void 0!==l?l:_.aq;const a=e.getMiterLimit();i.miterLimit=void 0!==a?a:_.eL,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0}createFill(t){const e=t.fillStyle,i=[h.SET_FILL_STYLE,e];return"string"!=typeof e&&i.push(t.fillPatternScale),i}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[h.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const i=t.fillStyle;"string"==typeof i&&t.currentFillStyle==i||(void 0!==i&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)}updateStrokeStyle(t,e){const i=t.strokeStyle,s=t.lineCap,n=t.lineDash,o=t.lineDashOffset,r=t.lineJoin,l=t.lineWidth,a=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=s||n!=t.currentLineDash&&!(0,f.aI)(t.currentLineDash,n)||t.currentLineDashOffset!=o||t.currentLineJoin!=r||t.currentLineWidth!=l||t.currentMiterLimit!=a)&&(void 0!==i&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=s,t.currentLineDash=n,t.currentLineDashOffset=o,t.currentLineJoin=r,t.currentLineWidth=l,t.currentMiterLimit=a)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[h.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=(0,u.o8)(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;(0,u.r)(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}};var p=i(3671);const m=class extends S{constructor(t,e,i,s){super(t,e,i,s)}drawFlatCoordinatess_(t,e,i,s){const n=this.state,c=void 0!==n.fillStyle,d=void 0!==n.strokeStyle,g=i.length;this.instructions.push(l),this.hitDetectionInstructions.push(l);for(let n=0;n<g;++n){const o=i[n],r=this.coordinates.length,l=this.appendFlatLineCoordinates(t,e,o,s,!0,!d),c=[h.MOVE_TO_LINE_TO,r,l];this.instructions.push(c),this.hitDetectionInstructions.push(c),d&&(this.instructions.push(a),this.hitDetectionInstructions.push(a)),e=o}return c&&(this.instructions.push(o),this.hitDetectionInstructions.push(o)),d&&(this.instructions.push(r),this.hitDetectionInstructions.push(r)),e}drawCircle(t,e,i){const s=this.state,n=s.fillStyle,a=s.strokeStyle;if(void 0===n&&void 0===a)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),void 0!==s.fillStyle&&this.hitDetectionInstructions.push([h.SET_FILL_STYLE,_.qY]),void 0!==s.strokeStyle&&this.hitDetectionInstructions.push([h.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,_.Oq,_.vk]);const c=t.getFlatCoordinates(),d=t.getStride(),g=this.coordinates.length;this.appendFlatLineCoordinates(c,0,c.length,d,!1,!1);const u=[h.CIRCLE,g];this.instructions.push(l,u),this.hitDetectionInstructions.push(l,u),void 0!==s.fillStyle&&(this.instructions.push(o),this.hitDetectionInstructions.push(o)),void 0!==s.strokeStyle&&(this.instructions.push(r),this.hitDetectionInstructions.push(r)),this.endGeometry(e)}drawPolygon(t,e,i){const s=this.state,n=s.fillStyle,o=s.strokeStyle;if(void 0===n&&void 0===o)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),void 0!==s.fillStyle&&this.hitDetectionInstructions.push([h.SET_FILL_STYLE,_.qY]),void 0!==s.strokeStyle&&this.hitDetectionInstructions.push([h.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,_.Oq,_.vk]);const r=t.getEnds(),l=t.getOrientedFlatCoordinates(),a=t.getStride();this.drawFlatCoordinatess_(l,0,r,a),this.endGeometry(e)}drawMultiPolygon(t,e,i){const s=this.state,n=s.fillStyle,o=s.strokeStyle;if(void 0===n&&void 0===o)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),void 0!==s.fillStyle&&this.hitDetectionInstructions.push([h.SET_FILL_STYLE,_.qY]),void 0!==s.strokeStyle&&this.hitDetectionInstructions.push([h.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,_.Oq,_.vk]);const r=t.getEndss(),l=t.getOrientedFlatCoordinates(),a=t.getStride();let c=0;for(let t=0,e=r.length;t<e;++t)c=this.drawFlatCoordinatess_(l,c,r[t],a);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(0!==t){const e=this.coordinates;for(let i=0,s=e.length;i<s;++i)e[i]=(0,p.n$)(e[i],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;void 0!==t.fillStyle&&this.updateFillStyle(t,this.createFill),void 0!==t.strokeStyle&&this.updateStrokeStyle(t,this.applyStroke)}};var y=i(4087),T=i(1597);function C(t,e,i,s,n){const o=[];let r=i,l=0,a=e.slice(i,2);for(;l<t&&r+n<s;){const[i,s]=a.slice(-2),h=e[r+n],c=e[r+n+1],d=Math.sqrt((h-i)*(h-i)+(c-s)*(c-s));if(l+=d,l>=t){const e=(t-l+d)/d,g=(0,T.Cc)(i,h,e),u=(0,T.Cc)(s,c,e);a.push(g,u),o.push(a),a=[g,u],l==t&&(r+=n),l=0}else if(l<t)a.push(e[r+n],e[r+n+1]),r+=n;else{const t=d-l,e=(0,T.Cc)(i,h,t/d),g=(0,T.Cc)(s,c,t/d);a.push(e,g),o.push(a),a=[e,g],l=0,r+=n}}return l>0&&o.push(a),o}function v(t,e,i,s,n){let o,r,l,a,h,c,d,g,u,_,f=i,x=i,S=0,p=0,m=i;for(r=i;r<s;r+=n){const i=e[r],s=e[r+1];void 0!==h&&(u=i-h,_=s-c,a=Math.sqrt(u*u+_*_),void 0!==d&&(p+=l,o=Math.acos((d*u+g*_)/(l*a)),o>t&&(p>S&&(S=p,f=m,x=r),p=0,m=r-n)),l=a,d=u,g=_),h=i,c=s}return p+=a,p>S?[m,r]:[f,x]}const I={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},R={Circle:m,Default:S,Image:class extends S{constructor(t,e,i,s){super(t,e,i,s),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e,i){if(!this.image_||this.maxExtent&&!(0,u.Ym)(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,e,i);const s=t.getFlatCoordinates(),n=t.getStride(),o=this.coordinates.length,r=this.appendFlatPointCoordinates(s,n);this.instructions.push([h.DRAW_IMAGE,o,r,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([h.DRAW_IMAGE,o,r,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e,i){if(!this.image_)return;this.beginGeometry(t,e,i);const s=t.getFlatCoordinates(),n=[];for(let e=0,i=s.length;e<i;e+=t.getStride())this.maxExtent&&!(0,u.Ym)(this.maxExtent,s.slice(e,e+2))||n.push(s[e],s[e+1]);const o=this.coordinates.length,r=this.appendFlatPointCoordinates(n,2);this.instructions.push([h.DRAW_IMAGE,o,r,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([h.DRAW_IMAGE,o,r,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const i=t.getAnchor(),s=t.getSize(),n=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=s[1],this.opacity_=t.getOpacity(),this.originX_=n[0],this.originY_=n[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=s[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}},LineString:class extends S{constructor(t,e,i,s){super(t,e,i,s)}drawFlatCoordinates_(t,e,i,s){const n=this.coordinates.length,o=this.appendFlatLineCoordinates(t,e,i,s,!1,!1),r=[h.MOVE_TO_LINE_TO,n,o];return this.instructions.push(r),this.hitDetectionInstructions.push(r),i}drawLineString(t,e,i){const s=this.state,n=s.strokeStyle,o=s.lineWidth;if(void 0===n||void 0===o)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(t,e,i),this.hitDetectionInstructions.push([h.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,_.Oq,_.vk],l);const a=t.getFlatCoordinates(),c=t.getStride();this.drawFlatCoordinates_(a,0,a.length,c),this.hitDetectionInstructions.push(r),this.endGeometry(e)}drawMultiLineString(t,e,i){const s=this.state,n=s.strokeStyle,o=s.lineWidth;if(void 0===n||void 0===o)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(t,e,i),this.hitDetectionInstructions.push([h.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,_.Oq,_.vk],l);const a=t.getEnds(),c=t.getFlatCoordinates(),d=t.getStride();let g=0;for(let t=0,e=a.length;t<e;++t)g=this.drawFlatCoordinates_(c,g,a[t],d);this.hitDetectionInstructions.push(r),this.endGeometry(e)}finish(){const t=this.state;return null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&this.instructions.push(r),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(r),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(l)}},Polygon:m,Text:class extends S{constructor(t,e,i,s){super(t,e,i,s),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[_.qY]={fillStyle:_.qY},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e,i){const s=this.textFillState_,n=this.textStrokeState_,o=this.textState_;if(""===this.text_||!o||!s&&!n)return;const r=this.coordinates;let l=r.length;const a=t.getType();let c=null,d=t.getStride();if("line"!==o.placement||"LineString"!=a&&"MultiLineString"!=a&&"Polygon"!=a&&"MultiPolygon"!=a){let s=o.overflow?null:[];switch(a){case"Point":case"MultiPoint":c=t.getFlatCoordinates();break;case"LineString":c=t.getFlatMidpoint();break;case"Circle":c=t.getCenter();break;case"MultiLineString":c=t.getFlatMidpoints(),d=2;break;case"Polygon":c=t.getFlatInteriorPoint(),o.overflow||s.push(c[2]/this.resolution),d=3;break;case"MultiPolygon":const e=t.getFlatInteriorPoints();c=[];for(let t=0,i=e.length;t<i;t+=3)o.overflow||s.push(e[t+2]/this.resolution),c.push(e[t],e[t+1]);if(0===c.length)return;d=2}const n=this.appendFlatPointCoordinates(c,d);if(n===l)return;if(s&&(n-l)/2!=c.length/d){let t=l/2;s=s.filter(((e,i)=>{const s=r[2*(t+i)]===c[i*d]&&r[2*(t+i)+1]===c[i*d+1];return s||--t,s}))}this.saveTextStates_(),(o.backgroundFill||o.backgroundStroke)&&(this.setFillStrokeStyle(o.backgroundFill,o.backgroundStroke),o.backgroundFill&&this.updateFillStyle(this.state,this.createFill),o.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e,i);let g=o.padding;if(g!=_.Tq&&(o.scale[0]<0||o.scale[1]<0)){let t=o.padding[0],e=o.padding[1],i=o.padding[2],s=o.padding[3];o.scale[0]<0&&(e=-e,s=-s),o.scale[1]<0&&(t=-t,i=-i),g=[t,e,i,s]}const u=this.pixelRatio;this.instructions.push([h.DRAW_IMAGE,l,n,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,g==_.Tq?_.Tq:g.map((function(t){return t*u})),!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,s]);const f=1/u,x=this.state.fillStyle;o.backgroundFill&&(this.state.fillStyle=_.qY,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([h.DRAW_IMAGE,l,n,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[f,f],NaN,this.declutterMode_,this.declutterImageWithText_,g,!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?_.qY:this.fillKey_,this.textOffsetX_,this.textOffsetY_,s]),o.backgroundFill&&(this.state.fillStyle=x,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(e)}else{if(!(0,u.HY)(this.maxExtent,t.getExtent()))return;let s;if(c=t.getFlatCoordinates(),"LineString"==a)s=[c.length];else if("MultiLineString"==a)s=t.getEnds();else if("Polygon"==a)s=t.getEnds().slice(0,1);else if("MultiPolygon"==a){const e=t.getEndss();s=[];for(let t=0,i=e.length;t<i;++t)s.push(e[t][0])}this.beginGeometry(t,e,i);const n=o.repeat,h=n?void 0:o.textAlign;let g=0;for(let t=0,e=s.length;t<e;++t){let e;e=n?C(n*this.resolution,c,g,s[t],d):[c.slice(g,s[t])];for(let i=0,n=e.length;i<n;++i){const n=e[i];let a=0,c=n.length;if(null==h){const t=v(o.maxAngle,n,0,n.length,2);a=t[0],c=t[1]}for(let t=a;t<c;t+=d)r.push(n[t],n[t+1]);const u=r.length;g=s[t],this.drawChars_(l,u),l=u}}this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,s=this.strokeKey_;t&&(s in this.strokeStates||(this.strokeStates[s]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const n=this.textKey_;n in this.textStates||(this.textStates[n]={font:e.font,textAlign:e.textAlign||_.MY,justify:e.justify,textBaseline:e.textBaseline||_.M8,scale:e.scale});const o=this.fillKey_;i&&(o in this.fillStates||(this.fillStates[o]={fillStyle:i.fillStyle}))}drawChars_(t,e){const i=this.textStrokeState_,s=this.textState_,n=this.strokeKey_,o=this.textKey_,r=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,a=I[s.textBaseline],c=this.textOffsetY_*l,d=this.text_,g=i?i.lineWidth*Math.abs(s.scale[0])/2:0;this.instructions.push([h.DRAW_CHARS,t,e,a,s.overflow,r,s.maxAngle,l,c,n,g*l,d,o,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([h.DRAW_CHARS,t,e,a,s.overflow,r?_.qY:r,s.maxAngle,l,c,n,g*l,d,o,1/l,this.declutterMode_,this.textKeepUpright_])}setTextStyle(t,e){let i,s,n;if(t){const e=t.getFill();e?(s=this.textFillState_,s||(s={},this.textFillState_=s),s.fillStyle=(0,g.F)(e.getColor()||_.qY)):(s=null,this.textFillState_=s);const o=t.getStroke();if(o){n=this.textStrokeState_,n||(n={},this.textStrokeState_=n);const t=o.getLineDash(),e=o.getLineDashOffset(),i=o.getWidth(),s=o.getMiterLimit();n.lineCap=o.getLineCap()||_._m,n.lineDash=t?t.slice():_.Oq,n.lineDashOffset=void 0===e?_.vk:e,n.lineJoin=o.getLineJoin()||_._K,n.lineWidth=void 0===i?_.aq:i,n.miterLimit=void 0===s?_.eL:s,n.strokeStyle=(0,g.F)(o.getColor()||_.NT)}else n=null,this.textStrokeState_=n;i=this.textState_;const r=t.getFont()||_.ZV;(0,_.fZ)(r);const l=t.getScaleArray();i.overflow=t.getOverflow(),i.font=r,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.repeat=t.getRepeat(),i.justify=t.getJustify(),i.textBaseline=t.getTextBaseline()||_.M8,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||_.Tq,i.scale=void 0===l?[1,1]:l;const a=t.getOffsetX(),h=t.getOffsetY(),c=t.getRotateWithView(),d=t.getKeepUpright(),u=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=void 0===a?0:a,this.textOffsetY_=void 0===h?0:h,this.textRotateWithView_=void 0!==c&&c,this.textKeepUpright_=void 0===d||d,this.textRotation_=void 0===u?0:u,this.strokeKey_=n?("string"==typeof n.strokeStyle?n.strokeStyle:(0,y.v6)(n.strokeStyle))+n.lineCap+n.lineDashOffset+"|"+n.lineWidth+n.lineJoin+n.miterLimit+"["+n.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=s&&s.fillStyle?"string"==typeof s.fillStyle?s.fillStyle:"|"+(0,y.v6)(s.fillStyle):""}else this.text_="";this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}},k=class{constructor(t,e,i,s){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=s,this.resolution_=i,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const i=this.buildersByZIndex_[e];for(const s in i){const n=i[s].finish();t[e][s]=n}}return t}getBuilder(t,e){const i=void 0!==t?t.toString():"0";let s=this.buildersByZIndex_[i];void 0===s&&(s={},this.buildersByZIndex_[i]=s);let n=s[e];return void 0===n&&(n=new(0,R[e])(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),s[e]=n),n}};var w=i(808),L=i(9703),E=i(7622);function D(t,e,i,s,n,o,r,l,a,h,c,d,g=!0){let u=t[e],_=t[e+1],f=0,x=0,S=0,p=0;function m(){f=u,x=_,u=t[e+=s],_=t[e+1],p+=S,S=Math.sqrt((u-f)*(u-f)+(_-x)*(_-x))}do{m()}while(e<i-s&&p+S<o);let y=0===S?0:(o-p)/S;const C=(0,T.Cc)(f,u,y),v=(0,T.Cc)(x,_,y),I=e-s,R=p,k=o+l*a(h,n,c);for(;e<i-s&&p+S<k;)m();y=0===S?0:(k-p)/S;const w=(0,T.Cc)(f,u,y),L=(0,T.Cc)(x,_,y);let D=!1;if(g)if(d){const t=[C,v,w,L];(0,E.e$)(t,0,4,2,d,t,t),D=t[0]>t[2]}else D=C>w;const O=Math.PI,M=[],F=I+s===e;let b;if(S=0,p=R,u=t[e=I],_=t[e+1],F){m(),b=Math.atan2(_-x,u-f),D&&(b+=b>0?-O:O);const t=(w+C)/2,e=(L+v)/2;return M[0]=[t,e,(k-o)/2,b,n],M}for(let t=0,d=(n=n.replace(/\n/g," ")).length;t<d;){m();let g=Math.atan2(_-x,u-f);if(D&&(g+=g>0?-O:O),void 0!==b){let t=g-b;if(t+=t>O?-2*O:t<-O?2*O:0,Math.abs(t)>r)return null}b=g;const C=t;let v=0;for(;t<d;++t){const r=l*a(h,n[D?d-t-1:t],c);if(e+s<i&&p+S<o+v+r/2)break;v+=r}if(t===C)continue;const I=D?n.substring(d-C,d-t):n.substring(C,t);y=0===S?0:(o+v/2-p)/S;const R=(0,T.Cc)(f,u,y),k=(0,T.Cc)(x,_,y);M.push([R,k,v/2,g,I]),o+=v}return M}var O=i(904);const M=(0,u.S5)(),F=[],b=[],A=[],P=[];function G(t){return t[3].declutterBox}const W=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function Y(t,e){return"start"===e?e=W.test(t)?"right":"left":"end"===e&&(e=W.test(t)?"left":"right"),I[e]}function B(t,e,i){return i>0&&t.push("\n",""),t.push(e,""),t}const N=class{constructor(t,e,i,s,n){this.overlaps=i,this.pixelRatio=e,this.resolution=t,this.alignAndScaleFill_,this.instructions=s.instructions,this.coordinates=s.coordinates,this.coordinateCache_={},this.renderedTransform_=(0,L.vt)(),this.hitDetectionInstructions=s.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=s.fillStates||{},this.strokeStates=s.strokeStates||{},this.textStates=s.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=n?new w.A:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,e,i,s){const n=t+e+i+s;if(this.labels_[n])return this.labels_[n];const o=s?this.strokeStates[s]:null,r=i?this.fillStates[i]:null,l=this.textStates[e],a=this.pixelRatio,h=[l.scale[0]*a,l.scale[1]*a],c=l.justify?I[l.justify]:Y(Array.isArray(t)?t[0]:t,l.textAlign||_.MY),d=s&&o.lineWidth?o.lineWidth:0,g=Array.isArray(t)?t:String(t).split("\n").reduce(B,[]),{width:u,height:f,widths:x,heights:S,lineWidths:p}=(0,_.jT)(l,g),m=u+d,y=[],T=(m+2)*h[0],C=(f+d)*h[1],v={width:T<0?Math.floor(T):Math.ceil(T),height:C<0?Math.floor(C):Math.ceil(C),contextInstructions:y};1==h[0]&&1==h[1]||y.push("scale",h),s&&(y.push("strokeStyle",o.strokeStyle),y.push("lineWidth",d),y.push("lineCap",o.lineCap),y.push("lineJoin",o.lineJoin),y.push("miterLimit",o.miterLimit),y.push("setLineDash",[o.lineDash]),y.push("lineDashOffset",o.lineDashOffset)),i&&y.push("fillStyle",r.fillStyle),y.push("textBaseline","middle"),y.push("textAlign","center");const R=.5-c;let k=c*m+R*d;const w=[],L=[];let E,D=0,O=0,M=0,F=0;for(let t=0,e=g.length;t<e;t+=2){const e=g[t];if("\n"===e){O+=D,D=0,k=c*m+R*d,++F;continue}const n=g[t+1]||l.font;n!==E&&(s&&w.push("font",n),i&&L.push("font",n),E=n),D=Math.max(D,S[M]);const o=[e,k+R*x[M]+c*(x[M]-p[F]),.5*(d+D)+O];k+=x[M],s&&w.push("strokeText",o),i&&L.push("fillText",o),++M}return Array.prototype.push.apply(y,w),Array.prototype.push.apply(y,L),this.labels_[n]=v,v}replayTextBackground_(t,e,i,s,n,o,r){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,s),t.lineTo.apply(t,n),t.lineTo.apply(t,e),o&&(this.alignAndScaleFill_=o[2],this.fill_(t)),r&&(this.setStrokeStyle_(t,r),t.stroke())}calculateImageOrLabelDimensions_(t,e,i,s,n,o,r,l,a,h,c,d,g,_,f,x){let S=i-(r*=d[0]),p=s-(l*=d[1]);const m=n+a>t?t-a:n,y=o+h>e?e-h:o,T=_[3]+m*d[0]+_[1],C=_[0]+y*d[1]+_[2],v=S-_[3],I=p-_[0];let R;return(f||0!==c)&&(F[0]=v,P[0]=v,F[1]=I,b[1]=I,b[0]=v+T,A[0]=b[0],A[1]=I+C,P[1]=A[1]),0!==c?(R=(0,L.Zz)((0,L.vt)(),i,s,1,1,c,-i,-s),(0,L.Bb)(R,F),(0,L.Bb)(R,b),(0,L.Bb)(R,A),(0,L.Bb)(R,P),(0,u.N)(Math.min(F[0],b[0],A[0],P[0]),Math.min(F[1],b[1],A[1],P[1]),Math.max(F[0],b[0],A[0],P[0]),Math.max(F[1],b[1],A[1],P[1]),M)):(0,u.N)(Math.min(v,v+T),Math.min(I,I+C),Math.max(v,v+T),Math.max(I,I+C),M),g&&(S=Math.round(S),p=Math.round(p)),{drawImageX:S,drawImageY:p,drawImageW:m,drawImageH:y,originX:a,originY:h,declutterBox:{minX:M[0],minY:M[1],maxX:M[2],maxY:M[3],value:x},canvasTransform:R,scale:d}}replayImageOrLabel_(t,e,i,s,n,o,r){const l=!(!o&&!r),a=s.declutterBox,h=r?r[2]*s.scale[0]/2:0;return a.minX-h<=e[0]&&a.maxX+h>=0&&a.minY-h<=e[1]&&a.maxY+h>=0&&(l&&this.replayTextBackground_(t,F,b,A,P,o,r),(0,_.Jw)(t,s.canvasTransform,n,i,s.originX,s.originY,s.drawImageW,s.drawImageH,s.drawImageX,s.drawImageY,s.scale)),!0}fill_(t){const e=this.alignAndScaleFill_;if(e){const i=(0,L.Bb)(this.renderedTransform_,[0,0]),s=512*this.pixelRatio;t.save(),t.translate(i[0]%s,i[1]%s),1!==e&&t.scale(e,e),t.rotate(this.viewRotation_)}t.fill(),e&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,i,s){const n=this.textStates[e],o=this.createLabel(t,e,s,i),r=this.strokeStates[i],l=this.pixelRatio,a=Y(Array.isArray(t)?t[0]:t,n.textAlign||_.MY),h=I[n.textBaseline||_.M8],c=r&&r.lineWidth?r.lineWidth:0;return{label:o,anchorX:a*(o.width/l-2*n.scale[0])+2*(.5-a)*c,anchorY:h*o.height/l+2*(.5-h)*c}}execute_(t,e,i,s,n,o,r,l){const a=this.zIndexContext_;let c;this.pixelCoordinates_&&(0,f.aI)(i,this.renderedTransform_)?c=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),c=(0,E.Rc)(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),(0,L.k3)(this.renderedTransform_,i));let d=0;const g=s.length;let x,S,p,m,y,T,C,v,I,R,k,w,M,F=0,b=0,A=0,P=null,W=null;const B=this.coordinateCache_,N=this.viewRotation_,q=Math.round(1e12*Math.atan2(-i[1],i[0]))/1e12,Z={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:N},X=this.instructions!=s||this.overlaps?0:200;let H,K,J,V;for(;d<g;){const i=s[d];switch(i[0]){case h.BEGIN_GEOMETRY:H=i[1],V=i[3],H.getGeometry()?void 0===r||(0,u.HY)(r,V.getExtent())?++d:d=i[2]+1:d=i[2],a&&(a.zIndex=i[4]);break;case h.BEGIN_PATH:b>X&&(this.fill_(t),b=0),A>X&&(t.stroke(),A=0),b||A||(t.beginPath(),y=NaN,T=NaN),++d;break;case h.CIRCLE:F=i[1];const s=c[F],g=c[F+1],f=c[F+2]-s,L=c[F+3]-g,E=Math.sqrt(f*f+L*L);t.moveTo(s+E,g),t.arc(s,g,E,0,2*Math.PI,!0),++d;break;case h.CLOSE_PATH:t.closePath(),++d;break;case h.CUSTOM:F=i[1],x=i[2];const j=i[3],z=i[4],U=i[5];Z.geometry=j,Z.feature=H,d in B||(B[d]=[]);const $=B[d];U?U(c,F,x,2,$):($[0]=c[F],$[1]=c[F+1],$.length=2),a&&(a.zIndex=i[6]),z($,Z),++d;break;case h.DRAW_IMAGE:F=i[1],x=i[2],I=i[3],S=i[4],p=i[5];let Q=i[6];const tt=i[7],et=i[8],it=i[9],st=i[10];let nt=i[11];const ot=i[12];let rt=i[13];m=i[14]||"declutter";const lt=i[15];if(!I&&i.length>=20){R=i[19],k=i[20],w=i[21],M=i[22];const t=this.drawLabelWithPointPlacement_(R,k,w,M);I=t.label,i[3]=I;const e=i[23];S=(t.anchorX-e)*this.pixelRatio,i[4]=S;const s=i[24];p=(t.anchorY-s)*this.pixelRatio,i[5]=p,Q=I.height,i[6]=Q,rt=I.width,i[13]=rt}let at,ht,ct,dt;i.length>25&&(at=i[25]),i.length>17?(ht=i[16],ct=i[17],dt=i[18]):(ht=_.Tq,ct=!1,dt=!1),st&&q?nt+=N:st||q||(nt-=N);let gt=0;for(;F<x;F+=2){if(at&&at[gt++]<rt/this.pixelRatio)continue;const i=this.calculateImageOrLabelDimensions_(I.width,I.height,c[F],c[F+1],rt,Q,S,p,et,it,nt,ot,n,ht,ct||dt,H),s=[t,e,I,i,tt,ct?P:null,dt?W:null];if(l){let t,e,n,o,r;if(lt){const i=x-F;if(!lt[i]){lt[i]={args:s,declutterMode:m};continue}const o=lt[i];t=o.args,e=o.declutterMode,delete lt[i],n=G(t)}if(!t||"declutter"===e&&l.collides(n)||(o=!0),"declutter"===m&&l.collides(i.declutterBox)||(r=!0),"declutter"===e&&"declutter"===m){const t=o&&r;o=t,r=t}o&&("none"!==e&&l.insert(n),this.replayImageOrLabel_.apply(this,t)),r&&("none"!==m&&l.insert(i.declutterBox),this.replayImageOrLabel_.apply(this,s))}else this.replayImageOrLabel_.apply(this,s)}++d;break;case h.DRAW_CHARS:const ut=i[1],_t=i[2],ft=i[3],xt=i[4];M=i[5];const St=i[6],pt=i[7],mt=i[8];w=i[9];const yt=i[10];R=i[11],k=i[12];const Tt=[i[13],i[13]];m=i[14]||"declutter";const Ct=i[15],vt=this.textStates[k],It=vt.font,Rt=[vt.scale[0]*pt,vt.scale[1]*pt];let kt;It in this.widths_?kt=this.widths_[It]:(kt={},this.widths_[It]=kt);const wt=(0,O.k)(c,ut,_t,2),Lt=Math.abs(Rt[0])*(0,_.TA)(It,R,kt);if(xt||Lt<=wt){const i=D(c,ut,_t,2,R,(wt-Lt)*Y(R,this.textStates[k].textAlign),St,Math.abs(Rt[0]),_.TA,It,kt,q?0:this.viewRotation_,Ct);t:if(i){const s=[];let n,o,r,a,h;if(w)for(n=0,o=i.length;n<o;++n){h=i[n],r=h[4],a=this.createLabel(r,k,"",w),S=h[2]+(Rt[0]<0?-yt:yt),p=ft*a.height+2*(.5-ft)*yt*Rt[1]/Rt[0]-mt;const o=this.calculateImageOrLabelDimensions_(a.width,a.height,h[0],h[1],a.width,a.height,S,p,0,0,h[3],Tt,!1,_.Tq,!1,H);if(l&&"declutter"===m&&l.collides(o.declutterBox))break t;s.push([t,e,a,o,1,null,null])}if(M)for(n=0,o=i.length;n<o;++n){h=i[n],r=h[4],a=this.createLabel(r,k,M,""),S=h[2],p=ft*a.height-mt;const o=this.calculateImageOrLabelDimensions_(a.width,a.height,h[0],h[1],a.width,a.height,S,p,0,0,h[3],Tt,!1,_.Tq,!1,H);if(l&&"declutter"===m&&l.collides(o.declutterBox))break t;s.push([t,e,a,o,1,null,null])}l&&"none"!==m&&l.load(s.map(G));for(let t=0,e=s.length;t<e;++t)this.replayImageOrLabel_.apply(this,s[t])}}++d;break;case h.END_GEOMETRY:if(void 0!==o){H=i[1];const t=o(H,V,m);if(t)return t}++d;break;case h.FILL:X?b++:this.fill_(t),++d;break;case h.MOVE_TO_LINE_TO:for(F=i[1],x=i[2],K=c[F],J=c[F+1],t.moveTo(K,J),y=K+.5|0,T=J+.5|0,F+=2;F<x;F+=2)K=c[F],J=c[F+1],C=K+.5|0,v=J+.5|0,F!=x-2&&C===y&&v===T||(t.lineTo(K,J),y=C,T=v);++d;break;case h.SET_FILL_STYLE:P=i,this.alignAndScaleFill_=i[2],b&&(this.fill_(t),b=0,A&&(t.stroke(),A=0)),t.fillStyle=i[1],++d;break;case h.SET_STROKE_STYLE:W=i,A&&(t.stroke(),A=0),this.setStrokeStyle_(t,i),++d;break;case h.STROKE:X?A++:t.stroke(),++d;break;default:++d}}b&&this.fill_(t),A&&t.stroke()}execute(t,e,i,s,n,o){this.viewRotation_=s,this.execute_(t,e,i,this.instructions,n,void 0,void 0,o)}executeHitDetection(t,e,i,s,n){return this.viewRotation_=i,this.execute_(t,[t.canvas.width,t.canvas.height],e,this.hitDetectionInstructions,!0,s,n)}};var q=i(8711),Z=i(3530);const X=["Polygon","Circle","LineString","Image","Text","Default"],H=["Image","Text"];X.filter((t=>!H.includes(t)));const K={},J=class{constructor(t,e,i,s,n,o,r){this.maxExtent_=t,this.overlaps_=s,this.pixelRatio_=i,this.resolution_=e,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=(0,L.vt)(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(n,r)}clip(t,e){const i=this.getClipCoords(e);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()}createExecutors_(t,e){for(const i in t){let s=this.executorsByZIndex_[i];void 0===s&&(s={},this.executorsByZIndex_[i]=s);const n=t[i];for(const t in n){const i=n[t];s[t]=new N(this.resolution_,this.pixelRatio_,this.overlaps_,i,e)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const i=this.executorsByZIndex_[e];for(let e=0,s=t.length;e<s;++e)if(t[e]in i)return!0}return!1}forEachFeatureAtCoordinate(t,e,i,s,n,o){const r=2*(s=Math.round(s))+1,l=(0,L.Zz)(this.hitDetectionTransform_,s+.5,s+.5,1/e,-1/e,-i,-t[0],-t[1]),a=!this.hitDetectionContext_;a&&(this.hitDetectionContext_=(0,q.Y)(r,r,void 0,{willReadFrequently:!0}));const h=this.hitDetectionContext_;let c;h.canvas.width!==r||h.canvas.height!==r?(h.canvas.width=r,h.canvas.height=r):a||h.clearRect(0,0,r,r),void 0!==this.renderBuffer_&&(c=(0,u.S5)(),(0,u.$C)(c,t),(0,u.r)(c,e*(this.renderBuffer_+s),c));const d=function(t){if(void 0!==K[t])return K[t];const e=2*t+1,i=t*t,s=new Array(i+1);for(let n=0;n<=t;++n)for(let o=0;o<=t;++o){const r=n*n+o*o;if(r>i)break;let l=s[r];l||(l=[],s[r]=l),l.push(4*((t+n)*e+(t+o))+3),n>0&&l.push(4*((t-n)*e+(t+o))+3),o>0&&(l.push(4*((t+n)*e+(t-o))+3),n>0&&l.push(4*((t-n)*e+(t-o))+3))}const n=[];for(let t=0,e=s.length;t<e;++t)s[t]&&n.push(...s[t]);return K[t]=n,n}(s);let g;function _(t,e,i){const l=h.getImageData(0,0,r,r).data;for(let a=0,c=d.length;a<c;a++)if(l[d[a]]>0){if(!o||"none"===i||"Image"!==g&&"Text"!==g||o.includes(t)){const i=(d[a]-3)/4,o=s-i%r,l=s-(i/r|0),h=n(t,e,o*o+l*l);if(h)return h}h.clearRect(0,0,r,r);break}}const x=Object.keys(this.executorsByZIndex_).map(Number);let S,p,m,y,T;for(x.sort(f.V_),S=x.length-1;S>=0;--S){const t=x[S].toString();for(m=this.executorsByZIndex_[t],p=X.length-1;p>=0;--p)if(g=X[p],y=m[g],void 0!==y&&(T=y.executeHitDetection(h,l,i,_,c),T))return T}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const i=e[0],s=e[1],n=e[2],o=e[3],r=[i,s,i,o,n,o,n,s];return(0,E.Rc)(r,0,8,2,t,r),r}isEmpty(){return(0,Z.p)(this.executorsByZIndex_)}execute(t,e,i,s,n,o,r){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(r?f.rG:f.V_),o=o||X;const a=X.length;for(let h=0,c=l.length;h<c;++h){const c=l[h].toString(),d=this.executorsByZIndex_[c];for(let c=0,g=o.length;c<g;++c){const g=o[c],u=d[g];if(void 0!==u){const o=null===r?void 0:u.getZIndexContext(),d=o?o.getContext():t,_=this.maxExtent_&&"Image"!==g&&"Text"!==g;if(_&&(d.save(),this.clip(d,i)),o&&"Text"!==g&&"Image"!==g?o.pushFunction((t=>u.execute(t,e,i,s,n,r))):u.execute(d,e,i,s,n,r),_&&d.restore(),o){o.offset();const t=l[h]*a+c;this.deferredZIndexContexts_[t]||(this.deferredZIndexContexts_[t]=[]),this.deferredZIndexContexts_[t].push(o)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const t=this.deferredZIndexContexts_,e=Object.keys(t).map(Number).sort(f.V_);for(let i=0,s=e.length;i<s;++i)t[e[i]].forEach((t=>{t.draw(this.renderedContext_),t.clear()})),t[e[i]].length=0}};var V=i(6597),j=i(1078),z=i(2703),U=i(4774);const $=class extends d{constructor(t,e,i,s,n,o,r){super(),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=s,this.transformRotation_=s?(0,T.Mg)(Math.atan2(s[1],s[0]),10):0,this.viewRotation_=n,this.squaredTolerance_=o,this.userTransform_=r,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=(0,L.vt)()}drawImages_(t,e,i,s){if(!this.image_)return;const n=(0,E.Rc)(t,e,i,s,this.transform_,this.pixelCoordinates_),o=this.context_,r=this.tmpLocalTransform_,l=o.globalAlpha;1!=this.imageOpacity_&&(o.globalAlpha=l*this.imageOpacity_);let a=this.imageRotation_;0===this.transformRotation_&&(a-=this.viewRotation_),this.imageRotateWithView_&&(a+=this.viewRotation_);for(let t=0,e=n.length;t<e;t+=2){const e=n[t]-this.imageAnchorX_,i=n[t+1]-this.imageAnchorY_;if(0!==a||1!=this.imageScale_[0]||1!=this.imageScale_[1]){const t=e+this.imageAnchorX_,s=i+this.imageAnchorY_;(0,L.Zz)(r,t,s,1,1,a,-t,-s),o.save(),o.transform.apply(o,r),o.translate(t,s),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.restore()}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,e,i,this.imageWidth_,this.imageHeight_)}1!=this.imageOpacity_&&(o.globalAlpha=l)}drawText_(t,e,i,s){if(!this.textState_||""===this.text_)return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const n=(0,E.Rc)(t,e,i,s,this.transform_,this.pixelCoordinates_),o=this.context_;let r=this.textRotation_;for(0===this.transformRotation_&&(r-=this.viewRotation_),this.textRotateWithView_&&(r+=this.viewRotation_);e<i;e+=s){const t=n[e]+this.textOffsetX_,i=n[e+1]+this.textOffsetY_;0!==r||1!=this.textScale_[0]||1!=this.textScale_[1]?(o.save(),o.translate(t-this.textOffsetX_,i-this.textOffsetY_),o.rotate(r),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.restore()):(this.textStrokeState_&&o.strokeText(this.text_,t,i),this.textFillState_&&o.fillText(this.text_,t,i))}}moveToLineTo_(t,e,i,s,n){const o=this.context_,r=(0,E.Rc)(t,e,i,s,this.transform_,this.pixelCoordinates_);o.moveTo(r[0],r[1]);let l=r.length;n&&(l-=2);for(let t=2;t<l;t+=2)o.lineTo(r[t],r[t+1]);return n&&o.closePath(),i}drawRings_(t,e,i,s){for(let n=0,o=i.length;n<o;++n)e=this.moveToLineTo_(t,e,i[n],s,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),(0,u.HY)(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=(0,U.v7)(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],s=e[3]-e[1],n=Math.sqrt(i*i+s*s),o=this.context_;o.beginPath(),o.arc(e[0],e[1],n,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}""!==this.text_&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t)}}drawFeature(t,e){const i=e.getGeometryFunction()(t);i&&(this.setStyle(e),this.drawGeometry(i))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let t=0,i=e.length;t<i;++t)this.drawGeometry(e[t])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),""!==this.text_&&this.drawText_(e,0,e.length,i)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),""!==this.text_&&this.drawText_(e,0,e.length,i)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),(0,u.HY)(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(""!==this.text_){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if((0,u.HY)(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();let s=0;const n=t.getEnds(),o=t.getStride();e.beginPath();for(let t=0,e=n.length;t<e;++t)s=this.moveToLineTo_(i,s,n[t],o,!1);e.stroke()}if(""!==this.text_){const e=t.getFlatMidpoints();this.drawText_(e,0,e.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),(0,u.HY)(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),(0,u.HY)(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getOrientedFlatCoordinates();let s=0;const n=t.getEndss(),o=t.getStride();e.beginPath();for(let t=0,e=n.length;t<e;++t){const e=n[t];s=this.drawRings_(i,s,e,o)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),(0,f.aI)(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,i=this.contextTextState_,s=t.textAlign?t.textAlign:_.MY;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=s&&(i.textAlign=s,e.textAlign=s),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=s,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:s,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(t){const e=t.getColor();this.fillState_={fillStyle:(0,g.F)(e||_.qY)}}else this.fillState_=null;if(e){const t=e.getColor(),i=e.getLineCap(),s=e.getLineDash(),n=e.getLineDashOffset(),o=e.getLineJoin(),r=e.getWidth(),l=e.getMiterLimit(),a=s||_.Oq;this.strokeState_={lineCap:void 0!==i?i:_._m,lineDash:1===this.pixelRatio_?a:a.map((t=>t*this.pixelRatio_)),lineDashOffset:(n||_.vk)*this.pixelRatio_,lineJoin:void 0!==o?o:_._K,lineWidth:(void 0!==r?r:_.aq)*this.pixelRatio_,miterLimit:void 0!==l?l:_.eL,strokeStyle:(0,g.F)(t||_.NT)}}else this.strokeState_=null}setImageStyle(t){let e;if(!t||!(e=t.getSize()))return void(this.image_=null);const i=t.getPixelRatio(this.pixelRatio_),s=t.getAnchor(),n=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=s[0]*i,this.imageAnchorY_=s[1]*i,this.imageHeight_=e[1]*i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=n[0],this.imageOriginY_=n[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const o=t.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/i,o[1]*this.pixelRatio_/i],this.imageWidth_=e[0]*i}setTextStyle(t){if(t){const e=t.getFill();if(e){const t=e.getColor();this.textFillState_={fillStyle:(0,g.F)(t||_.qY)}}else this.textFillState_=null;const i=t.getStroke();if(i){const t=i.getColor(),e=i.getLineCap(),s=i.getLineDash(),n=i.getLineDashOffset(),o=i.getLineJoin(),r=i.getWidth(),l=i.getMiterLimit();this.textStrokeState_={lineCap:void 0!==e?e:_._m,lineDash:s||_.Oq,lineDashOffset:n||_.vk,lineJoin:void 0!==o?o:_._K,lineWidth:void 0!==r?r:_.aq,miterLimit:void 0!==l?l:_.eL,strokeStyle:(0,g.F)(t||_.NT)}}else this.textStrokeState_=null;const s=t.getFont(),n=t.getOffsetX(),o=t.getOffsetY(),r=t.getRotateWithView(),l=t.getRotation(),a=t.getScaleArray(),h=t.getText(),c=t.getTextAlign(),d=t.getTextBaseline();this.textState_={font:void 0!==s?s:_.ZV,textAlign:void 0!==c?c:_.MY,textBaseline:void 0!==d?d:_.M8},this.text_=void 0!==h?Array.isArray(h)?h.reduce(((t,e,i)=>t+(i%2?" ":e)),""):h:"",this.textOffsetX_=void 0!==n?this.pixelRatio_*n:0,this.textOffsetY_=void 0!==o?this.pixelRatio_*o:0,this.textRotateWithView_=void 0!==r&&r,this.textRotation_=void 0!==l?l:0,this.textScale_=[this.pixelRatio_*a[0],this.pixelRatio_*a[1]]}else this.text_=""}};var Q=i(9700);i(6438);const tt=.5;var et=i(6141);const it={Point:function(t,e,i,s,n,o){const r=i.getImage(),l=i.getText(),a=l&&l.getText(),h=o&&r&&a?{}:void 0;if(r){if(r.getImageState()!=et.A.LOADED)return;const o=t.getBuilder(i.getZIndex(),"Image");o.setImageStyle(r,h),o.drawPoint(e,s,n)}if(a){const o=t.getBuilder(i.getZIndex(),"Text");o.setTextStyle(l,h),o.drawText(e,s,n)}},LineString:function(t,e,i,s,n){const o=i.getStroke();if(o){const r=t.getBuilder(i.getZIndex(),"LineString");r.setFillStrokeStyle(null,o),r.drawLineString(e,s,n)}const r=i.getText();if(r&&r.getText()){const o=t.getBuilder(i.getZIndex(),"Text");o.setTextStyle(r),o.drawText(e,s,n)}},Polygon:function(t,e,i,s,n){const o=i.getFill(),r=i.getStroke();if(o||r){const l=t.getBuilder(i.getZIndex(),"Polygon");l.setFillStrokeStyle(o,r),l.drawPolygon(e,s,n)}const l=i.getText();if(l&&l.getText()){const o=t.getBuilder(i.getZIndex(),"Text");o.setTextStyle(l),o.drawText(e,s,n)}},MultiPoint:function(t,e,i,s,n,o){const r=i.getImage(),l=r&&0!==r.getOpacity(),a=i.getText(),h=a&&a.getText(),c=o&&l&&h?{}:void 0;if(l){if(r.getImageState()!=et.A.LOADED)return;const o=t.getBuilder(i.getZIndex(),"Image");o.setImageStyle(r,c),o.drawMultiPoint(e,s,n)}if(h){const o=t.getBuilder(i.getZIndex(),"Text");o.setTextStyle(a,c),o.drawText(e,s,n)}},MultiLineString:function(t,e,i,s,n){const o=i.getStroke();if(o){const r=t.getBuilder(i.getZIndex(),"LineString");r.setFillStrokeStyle(null,o),r.drawMultiLineString(e,s,n)}const r=i.getText();if(r&&r.getText()){const o=t.getBuilder(i.getZIndex(),"Text");o.setTextStyle(r),o.drawText(e,s,n)}},MultiPolygon:function(t,e,i,s,n){const o=i.getFill(),r=i.getStroke();if(r||o){const l=t.getBuilder(i.getZIndex(),"Polygon");l.setFillStrokeStyle(o,r),l.drawMultiPolygon(e,s,n)}const l=i.getText();if(l&&l.getText()){const o=t.getBuilder(i.getZIndex(),"Text");o.setTextStyle(l),o.drawText(e,s,n)}},GeometryCollection:function(t,e,i,s,n,o){const r=e.getGeometriesArray();let l,a;for(l=0,a=r.length;l<a;++l)(0,it[r[l].getType()])(t,r[l],i,s,n,o)},Circle:function(t,e,i,s,n){const o=i.getFill(),r=i.getStroke();if(o||r){const l=t.getBuilder(i.getZIndex(),"Circle");l.setFillStrokeStyle(o,r),l.drawCircle(e,s,n)}const l=i.getText();if(l&&l.getText()){const n=t.getBuilder(i.getZIndex(),"Text");n.setTextStyle(l),n.drawText(e,s)}}};function st(t,e){const i=function(t,e){return.5*t/e}(t,e);return i*i}function nt(t,e,i,s,n,o,r,l){const a=[],h=i.getImage();if(h){let t=!0;const e=h.getImageState();e==et.A.LOADED||e==et.A.ERROR?t=!1:e==et.A.IDLE&&h.load(),t&&a.push(h.ready())}const c=i.getFill();c&&c.loading()&&a.push(c.ready());const d=a.length>0;return d&&Promise.all(a).then((()=>n(null))),function(t,e,i,s,n,o,r){const l=i.getGeometryFunction()(e);if(!l)return;const a=l.simplifyTransformed(s,n);i.getRenderer()?ot(t,a,i,e,r):(0,it[a.getType()])(t,a,i,e,r,o)}(t,e,i,s,o,r,l),d}function ot(t,e,i,s,n){if("GeometryCollection"!=e.getType())t.getBuilder(i.getZIndex(),"Default").drawCustom(e,s,i.getRenderer(),i.getHitDetectionRenderer(),n);else{const o=e.getGeometries();for(let e=0,r=o.length;e<r;++e)ot(t,o[e],i,s,n)}}var rt=i(6782),lt=i(6933);const at={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},ht={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class ct extends V.A{constructor(t,e){super(t,e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=(0,L.vt)(),this.tileClipContexts_=null}drawTile(t,e,i,s,n,o,r,l){this.updateExecutorGroup_(t,e.pixelRatio,e.viewState.projection),this.tileImageNeedsRender_(t)&&this.renderTileImage_(t,e),super.drawTile(t,e,i,s,n,o,r,l)}getTile(t,e,i,s){const n=this.getOrCreateTile(t,e,i,s);if(!n)return null;const o=s.viewState.resolution,r=s.viewHints;return!(!r[z.A.ANIMATING]&&!r[z.A.INTERACTING])&&n.wantedResolution||(n.wantedResolution=o),n}prepareFrame(t){const e=this.getLayer().getRevision();return this.renderedLayerRevision_!==e&&(this.renderedLayerRevision_=e,this.renderedTiles.length=0),super.prepareFrame(t)}updateExecutorGroup_(t,e,i){const s=this.getLayer(),n=s.getRevision(),o=s.getRenderOrder()||null,r=t.wantedResolution,l=t.getReplayState(s);if(!l.dirty&&l.renderedResolution===r&&l.renderedRevision==n&&l.renderedRenderOrder==o)return;const a=s.getSource(),h=!!s.getDeclutter(),c=a.getTileGrid(),d=a.getTileGridForProjection(i).getTileCoordExtent(t.wrappedTileCoord),g=a.getSourceTiles(e,i,t),_=(0,y.v6)(s);delete t.hitDetectionImageData[_],t.executorGroups[_]=[],l.dirty=!1;for(let i=0,n=g.length;i<n;++i){const n=g[i];if(n.getState()!=j.A.LOADED)continue;const f=n.tileCoord,x=c.getTileCoordExtent(f),S=(0,u._N)(d,x),p=(0,u.r)(S,s.getRenderBuffer()*r,this.tempExtent),m=(0,u.aI)(x,S)?null:p,y=new k(0,S,r,e),T=st(r,e),C=function(t,e){let i;const n=t.getStyleFunction()||s.getStyleFunction();if(n&&(i=n(t,r)),i){const s=this.renderFeature(t,T,i,y,h,e);l.dirty=l.dirty||s}},v=n.getFeatures();o&&o!==l.renderedRenderOrder&&v.sort(o);for(let t=0,e=v.length;t<e;++t){const e=v[t];m&&!(0,u.HY)(m,e.getGeometry().getExtent())||C.call(this,e,t)}const I=y.finish(),R="vector"!==s.getRenderMode()&&h&&1===g.length?null:S,w=new J(R,r,e,a.getOverlaps(),I,s.getRenderBuffer(),!0);t.executorGroups[_].push(w)}l.renderedRevision=n,l.renderedRenderOrder=o,l.renderedResolution=r}forEachFeatureAtCoordinate(t,e,i,s,n){const o=e.viewState.resolution,r=e.viewState.rotation;i=null==i?0:i;const l=this.getLayer(),a=l.getSource().getTileGridForProjection(e.viewState.projection),h=(0,u.Tr)([t]);(0,u.r)(h,o*i,h);const c={},d=function(t,e,i){let o=t.getId();void 0===o&&(o=(0,y.v6)(t));const r=c[o];if(r){if(!0!==r&&i<r.distanceSq){if(0===i)return c[o]=!0,n.splice(n.lastIndexOf(r),1),s(t,l,e);r.geometry=e,r.distanceSq=i}}else{if(0===i)return c[o]=!0,s(t,l,e);n.push(c[o]={feature:t,layer:l,geometry:e,distanceSq:i,callback:s})}},g=this.renderedTiles,_=(0,y.v6)(l),f=l.getDeclutter(),x=f?e.declutter[f].all().map((t=>t.value)):null;let S;t:for(let e=0,s=g.length;e<s;++e){const s=g[e],n=a.getTileCoordExtent(s.wrappedTileCoord);if(!(0,u.HY)(n,h))continue;const l=s.executorGroups[_];for(let e=0,s=l.length;e<s;++e)if(S=l[e].forEachFeatureAtCoordinate(t,o,r,i,d,x),S)break t}return S}getFeatures(t){return 0===this.renderedTiles.length?Promise.resolve([]):new Promise(((e,i)=>{const s=this.getLayer(),n=s.getSource(),o=this.renderedProjection,r=o.getExtent(),l=this.renderedResolution,a=n.getTileGridForProjection(o),h=(0,L.Bb)(this.renderedPixelToCoordinateTransform_,t.slice()),c=a.getTileCoordForCoordAndResolution(h,l).toString(),d=this.renderedTiles.find((t=>t.tileCoord.toString()===c&&t.getState()===j.A.LOADED));if(!d||d.loadingSourceTiles>0)return void e([]);n.getWrapX()&&o.canWrapX()&&!(0,u.ms)(r,a.getTileCoordExtent(d.tileCoord))&&(0,lt.Li)(h,o);const g=(0,y.v6)(s),_=a.getTileCoordExtent(d.wrappedTileCoord),x=(0,u.Py)(_),S=[(h[0]-x[0])/l,(x[1]-h[1])/l],p=d.getSourceTiles().reduce(((t,e)=>t.concat(e.getFeatures())),[]);let m=d.hitDetectionImageData[g];if(!m){const t=(0,rt.xq)(a.getTileSize(a.getZForResolution(l,n.zDirection))),e=this.renderedRotation_;m=function(t,e,i,s,n,o,r,l,a){const h=n,c=t[0]*tt,d=t[1]*tt,g=(0,q.Y)(c,d);g.imageSmoothingEnabled=!1;const _=g.canvas,x=new $(g,tt,n,null,r,void 0,null),S=i.length,p=Math.floor(16777215/S),m={};for(let t=1;t<=S;++t){const e=i[t-1],n=e.getStyleFunction()||s;if(!n)continue;let r=n(e,o);if(!r)continue;Array.isArray(r)||(r=[r]);const l=(t*p).toString(16).padStart(7,"#00000");for(let t=0,i=r.length;t<i;++t){const i=r[t],s=i.getGeometryFunction()(e);if(!s||!(0,u.HY)(h,s.getExtent()))continue;const n=i.clone(),o=n.getFill();o&&o.setColor(l);const a=n.getStroke();a&&(a.setColor(l),a.setLineDash(null)),n.setText(void 0);const c=i.getImage();if(c){const t=c.getImageSize();if(!t)continue;const e=(0,q.Y)(t[0],t[1],void 0,{alpha:!1}),i=e.canvas;e.fillStyle=l,e.fillRect(0,0,i.width,i.height),n.setImage(new Q.A({img:i,anchor:c.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:c.getOrigin(),opacity:1,size:c.getSize(),scale:c.getScale(),rotation:c.getRotation(),rotateWithView:c.getRotateWithView()}))}const d=n.getZIndex()||0;let g=m[d];g||(g={},m[d]=g,g.Polygon=[],g.Circle=[],g.LineString=[],g.Point=[]);const _=s.getType();if("GeometryCollection"===_){const t=s.getGeometriesArrayRecursive();for(let e=0,i=t.length;e<i;++e){const i=t[e];g[i.getType().replace("Multi","")].push(i,n)}}else g[_.replace("Multi","")].push(s,n)}}const y=Object.keys(m).map(Number).sort(f.V_);for(let t=0,i=y.length;t<i;++t){const i=m[y[t]];for(const t in i){const s=i[t];for(let t=0,i=s.length;t<i;t+=2){x.setStyle(s[t+1]);for(let i=0,n=e.length;i<n;++i)x.setTransform(e[i]),x.drawGeometry(s[t])}}}return g.getImageData(0,0,_.width,_.height)}(t,[this.getRenderTransform(a.getTileCoordCenter(d.wrappedTileCoord),l,0,tt,t[0]*tt,t[1]*tt,0)],p,s.getStyleFunction(),a.getTileCoordExtent(d.wrappedTileCoord),d.getReplayState(s).renderedResolution,e),d.hitDetectionImageData[g]=m}e(function(t,e,i){const s=[];if(i){const n=Math.floor(Math.round(t[0])*tt),o=Math.floor(Math.round(t[1])*tt),r=4*((0,T.qE)(n,0,i.width-1)+(0,T.qE)(o,0,i.height-1)*i.width),l=i.data[r],a=i.data[r+1],h=i.data[r+2]+256*(a+256*l),c=Math.floor(16777215/e.length);h&&h%c==0&&s.push(e[h/c-1])}return s}(S,p,m))}))}getFeaturesInExtent(t){const e=[],i=this.getTileCache();if(0===i.getCount())return e;const s=this.getLayer().getSource().getTileGridForProjection(this.frameState.viewState.projection),n=s.getZForResolution(this.renderedResolution),o={};return i.forEach((i=>{if(i.tileCoord[0]!==n||i.getState()!==j.A.LOADED)return;const r=i.getSourceTiles();for(let i=0,n=r.length;i<n;++i){const n=r[i],l=n.getKey();if(l in o)continue;o[l]=!0;const a=n.tileCoord;if((0,u.HY)(t,s.getTileCoordExtent(a))){const i=n.getFeatures();if(i)for(let s=0,n=i.length;s<n;++s){const n=i[s],o=n.getGeometry();(0,u.HY)(t,o.getExtent())&&e.push(n)}}}})),e}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&void 0!==this.renderedLayerRevision_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}renderDeclutter(t,e){const i=this.context,s=i.globalAlpha;i.globalAlpha=e.opacity;const n=t.viewHints,o=!(n[z.A.ANIMATING]||n[z.A.INTERACTING]),r=[this.context.canvas.width,this.context.canvas.height],l=this.getLayer().getDeclutter(),a=l?t.declutter[l]:void 0,h=(0,y.v6)(this.getLayer()),c=this.renderedTiles;for(let e=0,i=c.length;e<i;++e){const i=c[e],s=i.executorGroups[h];if(s)for(let e=s.length-1;e>=0;--e)s[e].execute(this.context,r,this.getTileRenderTransform(i,t),t.viewState.rotation,o,H,a)}i.globalAlpha=s}renderDeferredInternal(t){const e=this.renderedTiles,i=(0,y.v6)(this.getLayer()),s=e.reduce(((t,e,s)=>(e.executorGroups[i].forEach((e=>t.push({executorGroup:e,index:s}))),t)),[]),n=s.map((({executorGroup:t})=>t.getDeferredZIndexContexts())),o={};for(let t=0,e=s.length;t<e;++t){const e=s[t].executorGroup.getDeferredZIndexContexts();for(const t in e)o[t]=!0}Object.keys(o).map(Number).sort(f.V_).forEach((t=>{n.forEach(((e,i)=>{e[t]&&(e[t].forEach((t=>{const{executorGroup:e,index:n}=s[i],o=e.getRenderedContext(),r=o.globalAlpha;o.globalAlpha=this.renderedOpacity_;const l=this.tileClipContexts_[n];l&&l.draw(o),t.draw(o),l&&o.restore(),o.globalAlpha=r,t.clear()})),e[t].length=0)}))}))}getTileRenderTransform(t,e){const i=e.pixelRatio,s=e.viewState,n=s.center,o=s.resolution,r=s.rotation,l=e.size,a=Math.round(l[0]*i),h=Math.round(l[1]*i),c=this.getLayer().getSource().getTileGridForProjection(e.viewState.projection),d=t.tileCoord,g=c.getTileCoordExtent(t.wrappedTileCoord),u=c.getTileCoordExtent(d,this.tempExtent)[0]-g[0];return(0,L.lw)((0,L.hs)(this.inversePixelTransform.slice(),1/i,1/i),this.getRenderTransform(n,o,r,i,a,h,u))}postRender(t,e){const i=e.viewHints,s=!(i[z.A.ANIMATING]||i[z.A.INTERACTING]);this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice(),this.renderedRotation_=e.viewState.rotation,this.renderedOpacity_=e.layerStatesArray[e.layerIndex].opacity;const n=this.getLayer(),o=n.getRenderMode(),r=t.globalAlpha;t.globalAlpha=this.renderedOpacity_;const l=n.getDeclutter(),a=l?ht[o].filter((t=>!H.includes(t))):ht[o],h=e.viewState,c=h.rotation,d=n.getSource(),g=d.getTileGridForProjection(h.projection).getZForResolution(h.resolution,d.zDirection),_=this.renderedTiles,f=[],x=[],S=[],p=(0,y.v6)(n);let m=!0;for(let i=_.length-1;i>=0;--i){const o=_[i];m=m&&!o.getReplayState(n).dirty;const r=o.executorGroups[p].filter((t=>t.hasExecutors(a)));if(0===r.length)continue;const h=this.getTileRenderTransform(o,e),d=o.tileCoord[0];let y=!1;const T=r[0].getClipCoords(h);let C,v=t;if(T){C=new w.A,v=C.getContext();for(let t=0,e=f.length;t<e;++t)if(g!==d&&d<x[t]){const e=f[t];(0,u.HY)([T[0],T[3],T[4],T[7]],[e[0],e[3],e[4],e[7]])&&(y||(v.save(),y=!0),v.beginPath(),v.moveTo(T[0],T[1]),v.lineTo(T[2],T[3]),v.lineTo(T[4],T[5]),v.lineTo(T[6],T[7]),v.moveTo(e[6],e[7]),v.lineTo(e[4],e[5]),v.lineTo(e[2],e[3]),v.lineTo(e[0],e[1]),v.clip())}f.push(T),x.push(d)}for(let i=0,n=r.length;i<n;++i)r[i].execute(t,[t.canvas.width,t.canvas.height],h,c,s,a,e.declutter?.[l]);y&&(v===t?v.restore():S[i]=C)}t.globalAlpha=r,this.ready=m,this.tileClipContexts_=S,e.declutter||this.renderDeferredInternal(e),super.postRender(t,e)}renderFeature(t,e,i,s,n,o){if(!i)return!1;let r=!1;if(Array.isArray(i))for(let l=0,a=i.length;l<a;++l)r=nt(s,t,i[l],e,this.boundHandleStyleImageChange_,void 0,n,o)||r;else r=nt(s,t,i,e,this.boundHandleStyleImageChange_,void 0,n,o);return r}tileImageNeedsRender_(t){const e=this.getLayer();if("vector"===e.getRenderMode())return!1;const i=t.getReplayState(e),s=e.getRevision(),n=t.wantedResolution;return i.renderedTileResolution!==n||i.renderedTileRevision!==s}renderTileImage_(t,e){const i=this.getLayer(),s=t.getReplayState(i),n=i.getRevision(),o=t.executorGroups[(0,y.v6)(i)];s.renderedTileRevision=n;const r=t.wrappedTileCoord,l=r[0],a=i.getSource();let h=e.pixelRatio;const c=e.viewState.projection,d=a.getTileGridForProjection(c),g=d.getResolution(t.tileCoord[0]),u=e.pixelRatio/t.wantedResolution*g,_=d.getResolution(l),f=t.getContext();h=Math.round(Math.max(h,u/h));const x=a.getTilePixelSize(l,h,c);f.canvas.width=x[0],f.canvas.height=x[1];const S=h/u;if(1!==S){const t=(0,L.cL)(this.tmpTransform_);(0,L.hs)(t,S,S),f.setTransform.apply(f,t)}const p=d.getTileCoordExtent(r,this.tempExtent),m=u/_,T=(0,L.cL)(this.tmpTransform_);(0,L.hs)(T,m,-m),(0,L.Tl)(T,-p[0],-p[3]);for(let t=0,e=o.length;t<e;++t)o[t].execute(f,[f.canvas.width*S,f.canvas.height*S],T,0,!0,at[i.getRenderMode()],null);s.renderedTileResolution=t.wantedResolution}}const dt=ct;var gt=i(5360),ut=i(588);class _t extends s.A{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload;const i=void 0===t.cacheSize?0:t.cacheSize;delete t.cacheSize,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.cacheSize_=i;const s=t.renderMode||"hybrid";(0,ut.v)("hybrid"==s||"vector"==s,"`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=s,this.setPreload(t.preload?t.preload:0),this.setUseInterimTilesOnError(void 0===t.useInterimTilesOnError||t.useInterimTilesOnError),this.getBackground,this.setBackground}createRenderer(){return new dt(this,{cacheSize:this.cacheSize_})}getFeatures(t){return super.getFeatures(t)}getFeaturesInExtent(t){return this.getRenderer().getFeaturesInExtent(t)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(gt.A.PRELOAD)}getUseInterimTilesOnError(){return this.get(gt.A.USE_INTERIM_TILES_ON_ERROR)}setPreload(t){this.set(gt.A.PRELOAD,t)}setUseInterimTilesOnError(t){this.set(gt.A.USE_INTERIM_TILES_ON_ERROR,t)}}const ft=_t}}]);
//# sourceMappingURL=957.bundle.js.map